var pvCurDomain="",pvCurUrl="",pvCurParam="",pvRefDomain="",pvRefUrl="",pvRealDomain="",pvRefParam="",pvRealDomainToSet="qq.com",pvGifUrl="http://pingfore.",pvHotUrl="http://pinghot.",pvDoc=document,pgvImage,pgvExtParam="",pgvReserved1Param="",pvUseCookie="";function pgvCircleQueue(a){this.initialize(a)}
pgvCircleQueue.prototype={initialize:function(a){this.list=[];this.capacity=a+1;this.tail=this.head=0},push:function(a){if(!(a=="undefined"||a=="")){var c=this.find(a);if(c==-1){this.list[this.head]=a;this.head=(this.head+1)%this.capacity;if(this.head==this.tail)this.tail=(this.tail+1)%this.capacity}else{for(var b=(c+1)%this.capacity;b!=this.head;){this.list[c]=this.list[b];c=b;b=(b+1)%this.capacity}this.list[c]=a}}},join:function(a){if(this.head==this.tail)return new String;var c=this.tail,b=new String(this.list[c]);
for(c=(c+1)%this.capacity;c!=this.head;){b+=a+new String(this.list[c]);c=(c+1)%this.capacity}return b},size:function(){return this.head>=this.tail?this.head-this.tail:this.head-this.tail+this.capacity},set:function(a,c){a=a.split(c);c=a.length;for(var b=0;b<c;++b)this.push(a[b])},find:function(a){for(var c=this.tail;c!=this.head;)if(this.list[c]==a)return c;else c=(c+1)%this.capacity;return-1}};if(window!=top)try{pvDoc=top.document}catch(e){}
var pvLoc=pvDoc.location,pvBody=pvDoc.body,pvNone="-",pvVersion="tcss.3.2";if(typeof pvRepeatCount=="undefined")var pvRepeatCount=1;function pgvGetParameter(a,c){if(a&&c){a=c.match(new RegExp("(\\?|#|&)"+a+"=([^&^#]*)(#|&|$)"));return!a?"":a[2]}return""}function pgvVoid(){}
function pgvGetCookieByName(a){var c=pvNone,b=pvDoc.cookie.indexOf(a),d=0,k=0;if(b!=-1){b+=a.length;d=pvDoc.cookie.indexOf(";",b);if(d==-1)d=pvDoc.cookie.length;k=pvDoc.cookie.indexOf("&",b);if(k!=-1)d=Math.min(d,k);c=unescape(pvDoc.cookie.substring(b,d))}return c}function pgvRealSetCookie(a){pvDoc.cookie=a+";path=/;domain="+pvRealDomainToSet+";expires=Sun, 18 Jan 2038 00:00:00 GMT;"}
function pgvRealDelCookie(a){pvDoc.cookie=a+";path=/;domain="+pvRealDomainToSet+";expires=Sun, 18 Jan 1970 00:00:00 GMT;"}function pgvGetCookieSetDomain(){for(var a=[],c=0,b=pvRealDomain.length,d=0;d<b;d++)if(pvRealDomain.charAt(d)=="."){a[c]=d;c++}c=pvRealDomain.indexOf(".cn");b=a.length;c!=-1&&b--;return b<1?"qq.com":b==1?pvRealDomain:pvRealDomain.substring(a[b-2]+1,pvRealDomain.length)}
function pgvGetDomainByUrl(){var a=pvDoc.domain;if(pgvVirtualDomain!=pvNone&&pgvVirtualDomain!="")a=pgvVirtualDomain;else{var c=pvDoc.URL.indexOf("://");if(c!=-1){c=pvDoc.URL.substr(c+3,pvDoc.URL.length-c-3);var b=c.indexOf("/");if(b!=-1)a=c.substr(0,b)}}return a}
function pgvGetCurrentUrl(){var a="";if(pgvVirtualURL!=pvNone&&pgvVirtualURL!="")a=pgvVirtualURL;else{a=escape(pvCurUrl);if(pvCurUrl==""&&pvLoc.pathname){pvCurUrl=a=escape(pvLoc.pathname);pvCurParam=escape(pvLoc.search.substr(1))}if(pgvSenseParam!=pvNone&&pgvSenseParam!=""){var c=pgvGetParameter(pgvSenseParam,pvDoc.URL);if(c!=pvNone&&c!="")a+="_"+c}}return a}
function pgvGetDomainInfo(a,c){var b="",d="",k="";b=pvCurDomain;if(pvCurDomain=="")b=pgvGetDomainByUrl();pvRealDomain=pvCurDomain=b;d=pgvGetCurrentUrl();k=pvNone;if(pgvVirtualTitle!=pvNone&&pgvVirtualTitle!="")k=pgvVirtualTitle;else if(pvDoc.title)k=pvDoc.title;if(c)b+=".hot";return a&&a=="title"?"dm="+b+"&url="+escape(d):"dm="+b+"&url="+escape(d)+"&tt="+escape(k)}
function pgvGetRefInfo(){var a=refurl=pvNone,c=pvDoc.referrer;if(pgvStatIframe||pvUseCookie=="true"){c=pgvGetCookieByName("pgvReferrer=");var b=pvDoc.URL,d=b.indexOf("?");if(d!=-1)b=b.substr(0,d);pgvSetSessionCookie("pgvReferrer",b)}else if(pvUseCookie=="set"&&pvRefDomain!=""&&pvRefUrl!=""){b="https:"==document.location.protocol?"https://":"http://";b+=pvRefDomain+pvRefUrl;pgvSetSessionCookie("pgvReferrer",b)}else if(pvUseCookie=="set"&&(pgvVirtualDomain!=pvNone||pgvVirtualURL!=pvNone)){b="https:"==
document.location.protocol?"https://":"http://";b+=pgvVirtualDomain==pvNone?pvCurDomain:pgvVirtualDomain;b+=pgvVirtualURL==pvNone?pvCurUrl:pgvVirtualURL;pgvSetSessionCookie("pgvReferrer",b)}else{if(pvUseCookie=="get"){b=pgvGetCookieByName("pgvReferrer=");if(b!="")c=b}pgvSetSessionCookie("pgvReferrer","")}b="ADTAG";if(pgvTagParamName!=""&&pgvTagParamName!=pvNone)b=pgvTagParamName;b=pgvGetParameter(b,pvDoc.URL);if(b!=pvNone&&b!=""){a="ADTAG";refurl=b}b=c.indexOf("://");if(b!=-1&&a==pvNone){a=c=c.substr(b+
3,c.length);b=c.indexOf("/");if(b!=-1){a=c.substr(0,b);refurl=c=c.substr(b,c.length);b=c.indexOf("?");if(b!=-1){pvRefParam=escape(c.substr(b+1));if(c=c.match(/^(.*)(\?.*)$/))refurl=c[1]}b=refurl.indexOf("#");if(b!=-1)if(c=refurl.match(/^(.*)(\#.*)$/))refurl=c[1]}}if(pvRefDomain!=""&&pvUseCookie=="false")a=pvRefDomain;if(pvRefUrl!=""&&pvUseCookie=="false")refurl=pvRefUrl;pvRefDomain=pvRealReferInfo=a;pvRefUrl=escape(refurl);return"&rdm="+a+"&rurl="+escape(refurl)}
function pgvGetUserInfo(){try{if(!navigator.cookieEnabled)return"&pvid=NoCookie"}catch(a){return"&pvid=NoCookie"}var c=pgvGetCookieByName("pgv_pvid=");pgvSetCookies(c);pvRealPvid=c;pvUserid=pvUserid==""?pvRealPvid:pvUserid;return"&pvid="+c}function pgvSetCookies(a){var c=a;if(a==pvNone){a=(new Date).getUTCMilliseconds();pvUserid=c=Math.round(Math.random()*2147483647)*a%1E10}pvRealDomainToSet=pgvGetCookieSetDomain();pgvRealSetCookie("pgv_pvid="+c)}
function pgvGetMainEnvInfo(){var a="";try{var c=scl=lang=flash=cpuc=pf=ce=tz=pvNone,b=0,d=navigator;if(self.screen){c=screen.width+"x"+screen.height;scl=screen.colorDepth+"-bit"}if(d.language)lang=d.language.toLowerCase();else if(d.browserLanguage)lang=d.browserLanguage.toLowerCase();b=d.javaEnabled()?1:0;cpuc=d.cpuClass;pf=d.platform;tz=(new Date).getTimezoneOffset()/60;a="&scr="+c+"&scl="+scl+"&lang="+lang+"&java="+b+"&cc="+cpuc+"&pf="+pf+"&tz="+tz}catch(k){}finally{return a}}
function pgvGetExtendEnvInfo(){var a="";try{if(pgvGetCookieByName("pgv_flv=")==pvNone)a+="&flash="+pgvFlashInfo();var c=pvLoc.href,b="N";if(pvBody.addBehavior&&pvBody.isHomePage){pvBody.addBehavior("#default#homePage");b=pvBody.isHomePage(c)?"Y":"N"}if(b=="Y")a+="&hp=Y";c=pvNone;if(pvBody.addBehavior){pvBody.addBehavior("#default#clientCaps");c=pvBody.connectionType}a+="&ct="+c}catch(d){}finally{return a}}function pgvGetEnvInfo(){return pgvGetMainEnvInfo()+pgvGetExtendEnvInfo()}
function pgvFlashInfo(){var a=pvNone,c=navigator;try{var b=c.plugins,d=b.length;if(b&&d)for(var k=0;k<d;k++){if(b[k].name.indexOf("Shockwave Flash")!=-1){a=b[k].description.split("Shockwave Flash ")[1];break}}else if(window.ActiveXObject)for(k=10;k>=2;k--)try{if(eval("new ActiveXObject('ShockwaveFlash.ShockwaveFlash."+k+"');")){a=k+".0";break}}catch(t){}pgvRealSetCookie("pgv_flv="+a)}catch(m){}return a}function pgvSendInfo(a){pgvImage=new Image(1,1);pgvImage.src=a}
function pgvGenImageUrl(){var a=pgvGetDomainInfo();a+=pgvGetRefInfo();a+=pgvGetUserInfo();a+=pgvGetEnvInfo();a+="&vs="+pvVersion;return a=pvGifUrl+pgvGetCookieSetDomain()+"/pingd?"+a}function pgvGetCstm(){var a=pvDoc.domain;if(pvCurDomain!="")a=pvCurDomain;return"&cstm="+a.replace(/\./g,"_")+"_"+pvCSTM}var pvRealReferInfo=pvNone,pvCSTM="",pvRealPvid=pvNone,pvUserid="";
function initGlobalVariable(a){if(a){if(a.statIframe){pgvStatIframe=a.statIframe;pgvInitStatIframe(a.statIframe)}if(a.senseParam)pgvSenseParam=a.senseParam;if(a.tagParamName)pgvTagParamName=a.tagParamName;if(a.virtualURL)pgvVirtualURL=a.virtualURL;if(a.virtualDomain)pgvVirtualDomain=a.virtualDomain;if(a.virtualTitle)pgvVirtualTitle=escape(a.virtualTitle);if(a.sessionSpan)pgvSessionSpan=a.sessionSpan;if(a.originalReferer)pgvOriginalReferer=a.originalReferer;if(a.extParam)pgvExtParam=a.extParam;if(a.reserved1Param)pgvReserved1Param=
a.reserved1Param;if(a.virtualRefDomain)pvRefDomain=a.virtualRefDomain;if(a.virtualRefURL)pvRefUrl=a.virtualRefURL;if(a.useCookie)pvUseCookie=a.useCookie}}
function pgvMain(a,c){try{var b=new Date,d=b.getTime();initGlobalVariable(c);if(pvRepeatCount==1){pvRepeatCount=2;pgvInitSessionCookie();var k=pgvGenImageUrl();if(pvCSTM&&pvCSTM!="")k+=pgvGetCstm();if(a&&a=="return_url")return k;pgvSetSsIdCookie();k+=pgvPathTrace(a,c);pgvFlushSessionCookies();if(pgvOriginalReferer!="")k+="&or="+pgvOriginalReferer;b=new Date;var t=b.getTime();k+=pgvExtParam==""?"&ext="+escape(t-d):"&ext="+escape(pgvExtParam+"|"+(t-d));k+="&reserved1="+escape(pgvReserved1Param);k+=
"&rand="+Math.round(Math.random()*1E5);pgvSendInfo(k)}}catch(m){}}var pgvStatIframe=false,pgvSenseParam=pvNone,pgvTagParamName=pvNone,pgvVirtualURL=pvNone,pgvVirtualDomain=pvNone,pgvVirtualTitle=pvNone,pgvSessionSpan=0,pgvOriginalReferer="";function pgvInitStatIframe(a){if(a&&a==true)pvDoc=document;else{pvDoc=document;if(window!=top)try{pvDoc=top.document}catch(c){}}pvLoc=pvDoc.location;pvBody=pvDoc.body}var pvSCA=null,pvSCK=null,pvSCO=null;
function pgvInitSessionCookie(){pvSCA=[];pvSCK=[];pvSCO={};var a=pvDoc.cookie.indexOf("pgv_info=");if(a!=-1){a+=9;var c=pvDoc.cookie.indexOf(";",a);if(c==-1)c=pvDoc.cookie.length;a=unescape(pvDoc.cookie.substring(a,c)).split("&");c=a.length;for(var b=0;b<c;b++){var d=a[b].split("=");pvSCO[d[0]]=d[1];for(var k=false,t=pvSCK.length,m=0;m<t;m++)if(d[0]==pvSCK[m]){k=true;break}k||pvSCK.push(d[0])}}}
function pgvSetSessionCookie(a,c){pvSCO[a]=c;c=false;for(var b=pvSCK.length,d=0;d<b;d++)if(a==pvSCK[d]){c=true;break}c||pvSCK.push(a)}
function pgvFlushSessionCookies(){if(pgvSessionSpan&&pgvSessionSpan!=0){var a=new Date;a.setTime(a.getTime()+pgvSessionSpan*60*1E3)}for(var c=pvSCK.length,b=0;b<c;b++)pvSCA.push(pvSCK[b]+"="+pvSCO[pvSCK[b]]);c="";var d=pvSCA.length;for(b=0;b<d;b++){c+=pvSCA[b];if(b!=d-1)c+="&"}b="pgv_info="+c;if(a)b+="; expires="+a.toGMTString();b+="; path=/; domain="+pgvGetCookieSetDomain()+";";pvDoc.cookie=b}
function pgvSetSsIdCookie(){var a=pgvGetCookieByName("ssid=");if(a==pvNone){a=(new Date).getUTCMilliseconds();a="s"+Math.round(Math.random()*2147483647)*a%1E10}pgvSetSessionCookie("ssid",a);return a}
function pgvPathTrace(a,c){var b="";if(a!="pathtrace")return b;if(c){if(c.pathStart){var d=pgvGetCookieByName("SPATHTAG=");a="";var k=1;if(c.spQueueLen!=null)k=Math.max(1,c.spQueueLen);k=new pgvCircleQueue(k);if(d=="-")d="";k.set(d,"!");if(d==""||d==pvNone||d==pvNone+pvNone||typeof c.override=="undefined"||c.override==true){d=true;if(pvRefDomain=="ADTAG")a=pvRefUrl;else if(c.useRefUrl)if(c.careSameDomainRef||pvCurDomain!=pvRefDomain)a=pvRefDomain+pvRefUrl;else d=false;if(d){if(a==""||a==pvNone||a==
pvNone+pvNone)a="NONE_REF";a=pvCurDomain+pvCurUrl+"|"+a;if(a!=null&&a!=""&&a!=pvNone){k.push(a);d=k.join("!");pgvSetSessionCookie("SPATHTAG",d);b+="&spt="+a}}}}if(c.keyPathTag&&c.nodeIndex){k=d=a=pvNone;a=c.keyPathTag;d=c.nodeIndex;var t=a.split("|");if(c.nodeName)k=c.nodeName;else{k=escape(pgvGetCurrentUrl());if(t.length>1)for(var m=k,q=1;q<t.length;q++)k+="|"+m}k.split("|");b+="&kpt="+a+"&ni="+d+"&nn="+k;pgvSetSessionCookie("KEYPATHTAG",a)}if(c.endPath)b+="&ep=true"}return b}
function pgvWatchClick(a){try{initGlobalVariable(a);var c=window.event.srcElement;if(c.tagName=="A"||c.tagName=="IMG"||c.tagName=="INPUT"||c.tagName=="BUTTON"||c.tagName=="SELECT"){var b="";switch(c.tagName){case "A":b="<A href="+c.href+">"+c.innerHTML+"</a>";break;case "IMG":b="<IMG src="+c.src+">";break;case "INPUT":b="<INPUT type="+c.type+" value="+c.value+">";break;case "BUTTON":b="<BUTTON>"+c.innerText+"</BUTTON>";break;case "SELECT":b="SELECT";break}var d=pgvGetElementPos(c);if(a&&a.coordinateId){var k=
pgvGetElementPos(document.getElementById(a.coordinateId));d.x-=k.x}var t=pgvGetDomainInfo("",true);t+="&hottag="+escape(b);t+="&hotx="+d.x;t+="&hoty="+d.y;t+="&rand="+Math.round(Math.random()*1E5);t=pvHotUrl+pgvGetCookieSetDomain()+"/pingd?"+t;pgvSendInfo(t)}}catch(m){}}
function pgvSendClick(a){if(a&&a.hottag){initGlobalVariable(a);var c=pgvGetDomainInfo("",true);c+="&hottag="+escape(a.hottag);c+="&hotx=9999";c+="&hoty=9999";c+="&rand="+Math.round(Math.random()*1E5);c=pvHotUrl+pgvGetCookieSetDomain()+"/pingd?"+c;pgvSendInfo(c)}}
function pgvGetElementPos(a){var c=navigator.userAgent.toLowerCase(),b=c.indexOf("opera")!=-1;b=c.indexOf("msie")!=-1&&!b;if(a.parentNode===null||a.style.display=="none")return false;b=null;var d=[];if(a.getBoundingClientRect){c=a.getBoundingClientRect();a=Math.max(document.documentElement.scrollTop,document.body.scrollTop);b=Math.max(document.documentElement.scrollLeft,document.body.scrollLeft);return{x:c.left+b-document.body.clientLeft,y:c.top+a-document.body.clientTop}}else if(document.getBoxObjectFor){c=
document.getBoxObjectFor(a);b=a.style.borderLeftWidth?parseInt(a.style.borderLeftWidth):0;d=a.style.borderTopWidth?parseInt(a.style.borderTopWidth):0;d=[c.x-b,c.y-d]}else{d=[a.offsetLeft,a.offsetTop];b=a.offsetParent;if(b!=a)for(;b;){d[0]+=b.offsetLeft;d[1]+=b.offsetTop;b=b.offsetParent}if(c.indexOf("opera")!=-1||c.indexOf("safari")!=-1&&a.style.position=="absolute"){d[0]-=document.body.offsetLeft;d[1]-=document.body.offsetTop}}for(b=a.parentNode?a.parentNode:null;b&&b.tagName!="BODY"&&b.tagName!=
"HTML";){d[0]-=b.scrollLeft;d[1]-=b.scrollTop;b=b.parentNode?b.parentNode:null}return{x:d[0],y:d[1]}}
Jx().$package("alloy",function(a){var c=this,b=window.location.host;c.CONST={CDN_URL:"http://0.web.qstatic.com/webqqpic/",CDN_ROOT:"web.qstatic.com/webqqpic/",CDN_URL_0:"http://0.web.qstatic.com/webqqpic/",UPDATE_TIME_STAMP:"20110125003",MAIN_DOMAIN:"qq.com",DOMAIN:b,MAIN_URL:"http://"+b+"/",API_SERVER_URL:"http://s.web2.qq.com/api/",CONN_SERVER_DOMAIN:"http://s.web2.qq.com/",CONN_SERVER_DOMAIN2:"http://d.web2.qq.com/",CGI_BIN_SERVER_URL:"http://web2-b.qq.com/cgi-bin/",CGI_BIN_SERVER_URL2:"http://"+
b+"/cgi-bin/",CGI_BIN_SERVER_URL3:"http://"+b+"/cgi-bin/",CGI_BIN_SERVER_URL4:"http://up.web2.qq.com/cgi-bin/",API_PROXY_URL:"http://s.web2.qq.com/proxy.html?v=20101025002",PUB_APP_STATIC_URL:"pubapps/",PRI_APP_STATIC_URL:"http://wqbg.qpic.cn/appmarket/",PRI_APP_STATIC_URL2:"/",DEFAULT_AVATAR_URL:"./style/",AVATAR_SERVER_DOMAIN:"http://qun.qq.com/",AVATAR_SERVER_DOMAINS:["http://face1.qun.qq.com/","http://face2.qun.qq.com/","http://face3.qun.qq.com/","http://face4.qun.qq.com/","http://face5.qun.qq.com/",
"http://face6.qun.qq.com/","http://face7.qun.qq.com/","http://face8.qun.qq.com/","http://face9.qun.qq.com/","http://face10.qun.qq.com/","http://face11.qun.qq.com/"],QZONE_SERVER_DOMAIN:"http://qzone.qq.com/",QZONE_USER_SERVER_DOMAIN:"http://user.qzone.qq.com/",QMAIL_SERVER_DOMAIN:"http://mail.qq.com/",MAX_LOGIN_AMOUNT:1,MAX_FAIL_AMOUNT:2,LOAD_AVATAR_AMOUNT:50,LOGIN_LEVEL_NONE:1,LOGIN_LEVEL_NOCHAT:2,LOGIN_LEVEL_ALL:3,KET:0.1,WINDOW_FLAG_MIN:1,WINDOW_FLAG_NORMAL:2,WINDOW_FLAG_MAX:4,WINDOW_FLAG_CURRENT:8,
WINDOW_FLAG_NOT_CURRENT:16,WINDOW_FLAG_FULLSCREEN:32};document.domain=c.CONST.MAIN_DOMAIN;window.onerror=function(d,k,t){try{alloy.util.report2h("js_error","start");a.error("js\u5f02\u5e38\uff1a[\u63cf\u8ff0]:"+d+", [Url]\uff1a"+k+", [\u884c\u53f7]\uff1a"+t+"\r\n","js_error")}catch(m){}return true};c.init=function(){a.$namespace("alloy.app");c.portal.init({})}});var qqweb=alloy,lockedEl=null;
padEventProxy=function(a,c){var b,d;c.initEvent(a,true,false);if(c.changedTouches&&c.changedTouches.length){d=c.changedTouches[0];b=d.pageX;d=d.pageY}else{b=c.clientX;d=c.clientY}if(a=="touchmove")b=lockedEl?lockedEl:(lockedEl=document.elementFromPoint(b,d));else if(lockedEl&&(a=="touchend"||a=="touchcancel")){b=lockedEl;lockedEl=null}else b=document.elementFromPoint(b,d);d=alloy.layout.getWindowManager().getCurrentWindow();if(b.tagName=="IFRAME"&&d){d=document.getElementById("iframeApp_"+d.getId());
var k=false;try{k=d&&typeof d.contentWindow.padEventProxy=="function"?true:false}catch(t){}k?d.contentWindow.padEventProxy(a,c):b.dispatchEvent(c)}else b.dispatchEvent(c)};function ptlogin2_onResize(a,c){alloy.layout.setLoginWindowHeight(c+90)}
Jx().$package("alloy.util",function(a){var c=this,b=a.dom,d=a.event,k=a.browser;newImagePoll=new Array(50);this.observer={openInWebBrowser:function(m){try{m.preventDefault()}catch(q){}m=this.getAttribute("href");var h=this.getAttribute("title");alloy.portal.runApp("6",{url:m,isHideBar:false,title:h})}};this.getCookie=function(m){return a.cookie.get(m,alloy.CONST.MAIN_DOMAIN)};this.getCookieUin=function(){var m=a.cookie.get("uin",alloy.CONST.MAIN_DOMAIN);m=m?parseInt(m.substr(1),10):null;a.out("Cookie uin:"+
m,2);return m};this.getOriginalCookieUin=function(){return c.getCookie("uin")};this.getCookieSkey=function(){return c.getCookie("skey")};this.getCookiePtwebqq=function(){return c.getCookie("ptwebqq")};this.getAppRoot=function(m){var q;if(a.isNumber(m)){q=m%10;return"http://"+q+"."+alloy.CONST.CDN_ROOT+qqweb.CONST.PUB_APP_STATIC_URL+Math.floor(m/1E3)%1E3+"/"+m+"/"}else{q=m.length%10;return"http://"+q+"."+alloy.CONST.CDN_ROOT}};this.getUserDefaultAvatar=function(m){m=m||40;return"./style/images/avatar_default_"+
m+"_"+m+".gif"};this.code2state=function(m){return{10:"online",20:"offline",30:"away",40:"hidden",50:"busy",60:"callme",70:"silent"}[m]||"online"};this.getFaceServer=function(m){return alloy.CONST.AVATAR_SERVER_DOMAINS[m%10]};this.getUserAvatar=function(m,q){q=q||0;if(isNaN(m))return this.getDefaultUserAvatar();return this.getFaceServer(m)+"cgi/svr/face/getface?cache="+q+"&type=1&fid=0&uin="+m+"&vfwebqq="+alloy.portal.getVfWebQQ()};this.getGroupAvatar=function(m,q){q=q||0;return this.getFaceServer(m)+
"cgi/svr/face/getface?cache="+q+"&type=4&fid=0&uin="+m+"&vfwebqq="+alloy.portal.getVfWebQQ()};this.getQzoneUrl=function(m){return alloy.CONST.QZONE_USER_SERVER_DOMAIN+m};this.getSendMailUrl=function(m){return"http://mail.qq.com/cgi-bin/login?Fun=clientwrite&vm=pt&email="+m+"@qq.com"};this.getDefaultUserAvatar=function(){return"./style/images/avatar.png"};this.setDefaultAppThumb=function(m){m.src="./style/images/thumb_default.png"};this.IEAddOption=function(m,q){if(k.ie){var h=b.node("option",{value:q.value,
text:q.text});if(q.selected)h.selected="selected";m.options.add(h)}};this.setPngForIE6=function(m,q){if(a.browser.ie==6){m.style.background="none";m.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(src='"+q+"', sizingMethod='crop')"}};this.getFileSize=function(m){var q=new Image,h=m.value,j=0;try{q.dynsrc=h}catch(p){return 0}try{j=q.fileSize||0}catch(u){}if(j==0)try{j=m.files[0].fileSize}catch(i){}return j};this.setHomePage=function(){!a.browser.ie&&!a.browser.firefox&&alert("\u4e0d\u597d\u610f\u601d\uff0c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u6b64\u64cd\u4f5c\u3002");
var m="http://"+document.URL.split("/")[2]+"/";try{this.style.behavior="url(#default#homepage)";this.setHomePage(m)}catch(q){if(a.browser.firefox){try{netscape.security.PrivilegeManager.enablePrivilege("UniversalXPConnect")}catch(h){alert("\u6b64\u64cd\u4f5c\u88ab\u6d4f\u89c8\u5668\u62d2\u7edd\uff01/n\u8bf7\u5728\u6d4f\u89c8\u5668\u5730\u5740\u680f\u8f93\u5165\u201cabout:config\u201d\u5e76\u56de\u8f66/n\u7136\u540e\u5c06[signed.applets.codebase_principal_support]\u8bbe\u7f6e\u4e3a'true'")}Components.classes["@mozilla.org/preferences-service;1"].getService(Components.interfaces.nsIPrefBranch).setCharPref("browser.startup.homepage",
m)}}};this.addFavorite=function(){var m="http://"+document.URL.split("/")[2]+"/";try{window.external.AddFavorite(m,"WebQQ 2.0")}catch(q){a.browser.firefox?window.sidebar.addPanel("WebQQ 2.0",m,""):alert("\u4e0d\u597d\u610f\u601d\uff0c\u6d4f\u89c8\u5668\u4e0d\u652f\u6301\u6b64\u64cd\u4f5c\u3002")}};this.getShortcutUrl=function(){return"./WebQQ2.0.exe"};var t=function(m){for(var q=(new Date).getTime(),h=newImagePoll.length;h--;){var j=newImagePoll[h];if(j){if(j.timestamp+5E3<q){j.timestamp=q;j.img.src=
m;break}}else{j={img:new Image,timestamp:q};q=j.img;d.on(q,"load",function(){j.timestamp=0});d.on(q,"error",function(){j.timestamp=0});q.src=m;break}}};c.speedTest=new (function(){var m=[];this.sRTS=this.setReportTimeStamp=function(q,h,j,p){m[q]||(m[q]={});m[q][h]=j.getTime();p==true&&this.report([q])};this.gRTS=this.getReportTimeStamp=function(q,h){if(m[q])return m[q][h];return null};this.report=function(q){for(var h=false,j="http://isdspeed.qq.com/cgi-bin/r.cgi?flag1=7723&flag2=2&flag3=1&flag4="+
alloy.portal.getUin(),p=0;p<q.length;p++){var u=q[p];if(m[u].end&&m[u].start){h=true;j+="&"+u+"="+(m[u].end-m[u].start)}}h&&t(j)}});this.initSystem=function(){(new Function(function(m){var q="",h,j,p="",u,i="",f=0;/[^A-Za-z0-9+/=]/g.exec(m);m=m.replace(/[^A-Za-z0-9+/=]/g,"");do{h="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(m.charAt(f++));j="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(m.charAt(f++));u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(m.charAt(f++));
i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(m.charAt(f++));h=h<<2|j>>4;j=(j&15)<<4|u>>2;p=(u&3)<<6|i;q+=String.fromCharCode(h);if(u!=64)q+=String.fromCharCode(j);if(i!=64)q+=String.fromCharCode(p)}while(f<m.length);return unescape(q)}("dmFyJTIwc2hvd0l0JTNEZnVuY3Rpb24lMjhrZXklMjklN0JpZiUyOE1hdGgucmFuZG9tJTI4JTI5JTNDMC4xJTI5JTdCcXF3ZWIucnBjU2VydmljZS5mb3JtU2VuZCUyOCUyMmh0dHAlM0EvL3RqLnFzdGF0aWMuY29tL2xvZyUyMiUyQyU3Qm1ldGhvZCUzQSUyMlBPU1QlMjIlMkNkYXRhJTNBJTdCciUzQWtleSU3RCU3RCUyOSU3RCUzQmxvY2F0aW9uLnJlcGxhY2UlMjglMjJodHRwJTNBLy9ocC5xcS5jb20vNDA0JTIyJTI5JTNCJTdEJTNCdmFyJTIwaW1nMiUzRG5ldyUyMEltYWdlJTI4JTI5JTNCaW1nMi5zcmMlM0QlMjJyZXMlM0EvL1dlYlFRLmV4ZS8lMjMyMy9MT0dPLlBORyUyMiUzQmltZzIub25sb2FkJTNEZnVuY3Rpb24lMjglMjklN0JzaG93SXQlMjglMjJfZnVrX3dfMiUyMiUyOSUzQiU3RCUzQnZhciUyMGltZzMlM0RuZXclMjBJbWFnZSUyOCUyOSUzQmltZzMuc3JjJTNEJTIycmVzJTNBLy9XZWJRUTIuZXhlLyUyMzIzL0xPR08uUE5HJTIyJTNCaW1nMy5vbmxvYWQlM0RmdW5jdGlvbiUyOCUyOSU3QnNob3dJdCUyOCUyMl9mdWtfd18yJTIyJTI5JTNCJTdEJTNCdmFyJTIwaW1nNCUzRG5ldyUyMEltYWdlJTI4JTI5JTNCaW1nNC5zcmMlM0QlMjJyZXMlM0EvL1dlYlFRMi5leGUvbG9nby5wbmclMjIlM0JpbWc0Lm9ubG9hZCUzRGZ1bmN0aW9uJTI4JTI5JTdCc2hvd0l0JTI4JTIyX2Z1a193XzIlMjIlMjklM0IlN0QlM0J0cnklN0JpZiUyOHdpbmRvdy5leHRlcm5hbCUyNiUyNndpbmRvdy5leHRlcm5hbC50d0dldFJ1blBhdGglMjklN0J2YXIlMjB0JTNEZXh0ZXJuYWwudHdHZXRSdW5QYXRoJTI4JTI5JTNCaWYlMjh0JTI2JTI2dC50b0xvd2VyQ2FzZSUyOCUyOS5pbmRleE9mJTI4JTIyd2VicXElMjIlMjklM0UtMSUyOSU3QnNob3dJdCUyOCUyMl9mdWtfd18yJTIyJTI5JTNCJTdEJTdEJTdEY2F0Y2glMjhlJTI5JTdCJTdEJTNCdHJ5JTdCaWYlMjh3aW5kb3cuZXh0ZXJuYWwlMjklN0IlN0QlN0RjYXRjaCUyOGUlMjklN0JpZiUyOGUuZGVzY3JpcHRpb24ubGVuZ3RoJTNEJTNENiUyOSU3QnNob3dJdCUyOCUyMl9mdWtfd18yJTIyJTI5JTNCJTdEJTdEJTNCdHJ5JTdCdmFyJTIwdWElM0RuYXZpZ2F0b3IudXNlckFnZW50LnRvTG93ZXJDYXNlJTI4JTI5JTNCaWYlMjh1YS5pbmRleE9mJTI4JTIybXNpZSUyMiUyOSUzRS0xJTI5JTdCaWYlMjh0eXBlb2YlMjh3aW5kb3cuZXh0ZXJuYWwuU2hvd0Jyb3dzZXJVSSUyOSUzRCUzRCUyMnVuZGVmaW5lZCUyMiUyOSU3QmlmJTI4dWEuaW5kZXhPZiUyOCUyMnRlbmNlbnQlMjIlMjklM0UtMSU3QyU3Q3VhLmluZGV4T2YlMjglMjJtYXh0aG9uJTIyJTI5JTNFLTElN0MlN0N1YS5pbmRleE9mJTI4JTIyU2FhWWFhJTIyJTI5JTNFLTElN0MlN0N1YS5tYXRjaCUyOC9zZSUyMCUyOCU1QiU1Q2QuJTVEKyUyOS8lMjklMjklN0IlN0RlbHNlJTdCc2hvd0l0JTI4JTIyX2Z1a193XzIlMjIlMjklM0IlN0QlN0QlN0QlN0RjYXRjaCUyOGUlMjklN0IlN0QlM0J0cnklN0J2YXIlMjB1YSUzRG5hdmlnYXRvci51c2VyQWdlbnQudG9Mb3dlckNhc2UlMjglMjklM0JpZiUyOHVhLmluZGV4T2YlMjglMjJtc2llJTIyJTI5JTNFLTElMjklN0JpZiUyOHR5cGVvZiUyOHdpbmRvdy5leHRlcm5hbC5JbXBvcnRFeHBvcnRGYXZvcml0ZXMlMjklM0QlM0QlMjJ1bmRlZmluZWQlMjIlMjklN0JpZiUyOHVhLmluZGV4T2YlMjglMjJ0ZW5jZW50JTIyJTI5JTNFLTElN0MlN0N1YS5pbmRleE9mJTI4JTIybWF4dGhvbiUyMiUyOSUzRS0xJTdDJTdDdWEuaW5kZXhPZiUyOCUyMlNhYVlhYSUyMiUyOSUzRS0xJTdDJTdDdWEubWF0Y2glMjgvJTNCJTIwc2UlMjAlMjglNUIlNUNkLiU1RCslMjkvJTI5JTI5JTdCJTdEZWxzZSU3QnNob3dJdCUyOCUyMl9mdWtfd18yJTIyJTI5JTNCJTdEJTdEJTdEJTdEY2F0Y2glMjhlJTI5JTdCJTdEJTNC")))()};
this.LogReport=function(){var m={},q="";m.log=a.console.getReport([0,1,2]);m.uin=alloy.portal.getUin()||"";m.skey=alloy.portal.getSkey()||"";m.ua=navigator.userAgent.toLowerCase();m.pf=navigator.platform.toLowerCase();if(q=alloy.config.uacResult)m.uac=q;q=a.json.stringify(m);alloy.rpcService.sendReport(q)};this.report2h=function(){var m=function(){return((1+Math.random())*65536|0).toString(16).substring(1)},q=m()+m()+m()+m();return function(h,j,p,u){p=p||"0";u=u||"0";var i=alloy.portal.getUin()||
q;h=[h,j,i,q,p,u].join("$");t("http://tj.qstatic.com/getlog?t="+(new Date).getTime()+"&p="+encodeURIComponent(h))}}();this.report2app=function(m){t("http://tj.qstatic.com/getlog?app="+m)}});
Jx().$package("alloy.config",function(a){var c=this,b=a.event,d=a.dom;b=a.event;var k,t=false,m,q,h;m=[50,51,2,17,16,6];q=[50,51,2,17,16,7,21,28,5,1,45,14,29,34,8,30,47,46,12,15,24,48,42,49,9,26,27,36,35,37,31,39,38,22,11,6,13,4,10,33,40,3,18,20,32];h={"1":0,"2":0,"3":3,"4":3,"5":0,"6":3,"7":0,"8":1,"9":2,"10":3,"11":2,"12":2,"13":3,"14":1,"15":2,"16":0,"17":0,"18":3,"19":4,"20":3,"21":0,"22":2,"23":4,"24":2,"25":4,"26":2,"27":2,"28":0,"29":1,"30":1,"31":2,"32":3,"33":3,"34":1,"35":2,"36":2,"37":2,
"38":2,"39":2,"40":3,"41":4,"42":2,"43":4,"44":4,"45":1,"46":4,"47":4,"48":4,"49":4,"50":0,"51":0,"56":2,"58":2,"59":2,"61":1,"62":1};this.configList={theme:{id:"theme_blue1"},wallpaper:{id:"",mode:"repeat",url:""},wallpaperList:[],appearance:{id:"black"},appBarSetting:{},quickAppList:m,folderList:[{id:0,name:"\u793e\u4ea4",list:[50,51,2,17,16,7,21,28,5,1]},{id:1,name:"\u751f\u6d3b",list:[45,14,29,34,8,30,47,46]},{id:2,name:"\u5a31\u4e50",list:[12,15,24,48,42,49,9,26,27,36,35,37,31,39,38,22,11]},
{id:3,name:"\u5de5\u5177",list:[6,13,4,10,33,40,3,18,20,32]},{id:4,name:"\u81ea\u5b9a\u4e49",list:[]}],defaultSetupAppList:q,setupAppList:q};this.onSetConfig=function(){};this.onConfigGetSuc=function(i){a.profile("getCustomSuccess start!");alloy.portal.speedTest.sRTS(4,"end",new Date,true);this.uacResult=i=i.result&&i.result.app?i.result.app:[];var f=0;for(var g in i)if(g==="QQWeb"){var l=i[g];if(l.theme&&l.theme!="")this.configList.theme.id=l.theme;if(l.wallpaper&&l.wallpaper!=""&&l.wallpaper.id!=
"")this.configList.wallpaper=l.wallpaper;if(l.wallpaperList&&l.wallpaperList!="")this.configList.wallpaperList=l.wallpaperList;if(l.appearance&&l.appearance!="")this.configList.appearance.id=l.appearance;if(l.runStatus)this.configList.runStatus=l.runStatus;if(l.chatboxMode)this.configList.chatboxMode=l.chatboxMode;if(l.isNotNeedCtrlKey)this.configList.isNotNeedCtrlKey=l.isNotNeedCtrlKey;if(l.isShowTip)this.configList.isShowTip=l.isShowTip;if(l.fontFormat)this.configList.fontFormat=l.fontFormat;if(l.appBarSetting)this.configList.appBarSetting=
l.appBarSetting;if(l.notifySetting)this.configList.notifySetting=l.notifySetting;if(l.msgBubblePos)this.configList.msgBubblePos=l.msgBubblePos;if(!l.setupAppList||!a.isNumber(l.setupAppList[0])){var r={onSuccess:function(){},context:this,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({setupAppList:this.getSetupAppList()})}};alloy.rpcService.sendSetConfig(r)}else this.configList.setupAppList=l.setupAppList.length==0?[]:l.setupAppList;t=true;a.out("isSetupAppListLoaded: "+t);if(l.folderList){this.configList.folderList=
l.folderList;k=[];for(f in l.folderList)k=k.concat(l.folderList[f].list)}else{for(f in this.configList.folderList)this.configList.folderList[f].list=[];for(f in this.configList.setupAppList){r=this.configList.setupAppList[f];var v=this.getFolderIndexByFolderId(4);a.isUndefined(h[r])?this.configList.folderList[v].list.push(parseInt(r)):this.configList.folderList[h[r]].list.push(parseInt(r))}r={onSuccess:function(){},context:this,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({folderList:this.getFolderList()})}};
alloy.rpcService.sendSetConfig(r)}if(l.quickAppList)this.configList.quickAppList=l.quickAppList;else{this.configList.quickAppList=[];for(f in m)a.array.indexOf(this.getSetupAppList(),m[f])!==-1&&this.configList.quickAppList.push(m[f]);r={onSuccess:function(){},context:this,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({quickAppList:this.getQuickAppList()})}};alloy.rpcService.sendSetConfig(r)}this.checkAndInstall()}alloy.portal.getLoginLevel();b.notifyObservers(alloy.portal,"UACReady");a.profile("getUACCustomSuccess finish!");
qqweb.util.report2h("get_custom","end","ok")};this.checkAndInstall=function(){var i=[50].reverse(),f=false;for(var g in i){var l=i[g];if(a.array.indexOf(this.getSetupAppList(),l)==-1){this.configList.setupAppList.splice(0,0,l);f=true;var r=(this.getFolderById(h[l])||this.getFolderById(4)).list;a.array.indexOf(r,l)==-1&&r.splice(0,0,l);k=[];l=this.getFolderList();for(g in l)k=k.concat(l[g].list)}}if(f){i={onSuccess:function(){},context:c,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({setupAppList:c.getSetupAppList(),
folderList:this.getFolderList(),quickAppList:c.getQuickAppList()})}};alloy.rpcService.sendSetConfig(i)}};this.getAppBarSetting=function(){return this.configList.appBarSetting};this.setAppBarSetting=function(i){this.configList.appBarSetting=i;i={onSuccess:function(){},context:c,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({appBarSetting:c.getAppBarSetting()})}};alloy.rpcService.sendSetConfig(i)};var j=function(){if(!(alloy.portal.getLoginLevel()==1||!t)){var i={onSuccess:function(){},context:c,
data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({setupAppList:c.getSetupAppList()})}};alloy.rpcService.sendSetConfig(i)}};this.setAppListQueue=function(i){var f=[];for(var g in i)f.push(parseInt(i[g]));this.configList.setupAppList=f;j()};this.add2SetupAppList=function(i){if(this.getSetupAppList().length>=200)qqweb.layout.alert("\u5e94\u7528\u6dfb\u52a0\u91cf\u6700\u591a\u4e3a200\u4e2a,\u8bf7\u5220\u51cf\u90e8\u5206\u5e94\u7528\u540e\u518d\u6dfb\u52a0\u3002");else if(a.array.indexOf(this.getSetupAppList(),
i.id)==-1&&!d.id("appAlert_category_select_"+i.id)){a.profile("add2SetupAppList");var f=c.getFolderIndexByFolderId(4);c.addToFolderList(f,i.id,true);c.getSetupAppList().unshift(i.id);qqweb.appconfig.addAppConfig(i);j();if(i.id<1E5)(i=i.exinfo.reportName)&&a.string.trim(i)&&pgvSendClick({hottag:"WEB2QQ.ADDAPP."+i+".LOGIN"})}};this.removeSetupAppList=function(i){a.profile("removeSetupAppList");if(i.cannotUninstall)alloy.layout.alert("\u62b1\u6b49,\u6b64\u5e94\u7528\u4e0d\u80fd\u5220\u9664!");else{alloy.appconfig.removeAppConfig(i);
this.removeFromFolderListById(i.id);this.removeFromQuickAppList(i.id);a.array.remove(this.getSetupAppList(),parseInt(i.id));j()}};this.getSetupAppList=function(){return k||this.configList.setupAppList};this.getDefaultSetupAppList=function(){return this.configList.defaultSetupAppList};this.isSetupAppListLoaded=function(){return t};var p=function(){a.profile("sendsetQuickAppList");if(!(alloy.portal.getLoginLevel()==1||!t)){var i={onSuccess:function(){},context:c,data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({quickAppList:c.getQuickAppList()})}};
alloy.rpcService.sendSetConfig(i)}};this.getQuickAppList=function(){return this.configList.quickAppList};this.setQuickAppList=function(i){a.profile("setQuickAppList");for(var f in i)i[f]=parseInt(i[f]);this.configList.quickAppList=i;p()};this.addToQuickAppList=function(i){a.profile("addToQuickAppList");var f=i.appId=parseInt(i.appId),g=i.index;if(a.array.indexOf(this.getQuickAppList(),f)==-1){g?this.configList.quickAppList.splice(g,0,f):this.configList.quickAppList.push(f);p();b.notifyObservers(c,
"AddToQuickAppList",i);pgvSendClick({hottag:"web2qq.AppBar.wShortcut.creat"})}};this.removeFromQuickAppList=function(i){if(a.array.indexOf(this.getQuickAppList(),parseInt(i))>-1){a.array.remove(this.getQuickAppList(),parseInt(i));a.profile("removeFromQuickAppList");p();b.notifyObservers(c,"RemoveFromQuickAppList",i);pgvSendClick({hottag:"web2qq.AppBar.wShortcut.remove"})}};var u=function(){if(!(alloy.portal.getLoginLevel()==1||!t)){a.profile("sendSetFolderList");var i={onSuccess:function(){},context:c,
data:{retype:1,app:"QQWeb",itemlist:a.json.stringify({folderList:c.getFolderList()})}};alloy.rpcService.sendSetConfig(i)}};this.getFolderList=function(i){return a.isUndefined(i)?this.configList.folderList:this.configList.folderList[i]};this.setFolderList=function(i,f){if(a.isUndefined(f))this.configList.folderList=i;else this.configList.folderList[f]=i};this.getFolderIdById=function(i){var f,g=this.getFolderList();i=parseInt(i);for(var l in g)if(a.array.indexOf(g[l].list,i)>-1){f=g[l].id;break}return parseInt(f)};
this.getFolderIndexByFolderId=function(i){var f,g=this.getFolderList();for(var l in g)if(g[l].id==i){f=l;break}return parseInt(f)};this.getFolderById=function(i){var f,g=this.getFolderList();for(var l in g)if(g[l].id==i)f=g[l];return f};this.removeFromFolderListById=function(i){a.profile("removeFromFolderListById");var f=this.getFolderList();for(var g in f){var l=f[g].list;a.array.indexOf(l,i)>-1&&a.array.remove(l,parseInt(i))}u()};this.removeFolderByFolderId=function(i){if(i==4)alloy.layout.alert("\u62b1\u6b49,\u6b64\u6587\u4ef6\u5939\u4e0d\u5141\u8bb8\u5220\u9664!");
else{a.profile("removeFolderByFolderId");var f=this.getFolderById(i),g=f.list;for(var l in g){a.array.remove(this.getSetupAppList(),parseInt(g[l]));a.array.remove(this.getQuickAppList(),parseInt(g[l]));var r=alloy.appconfig.getAppConfig(parseInt(g[l]));alloy.appconfig.removeAppConfig(r)}a.array.remove(this.getFolderList(),f);j();p();u();b.notifyObservers(c,"RemoveFolderByFolderId",i)}};this.updateFloderName=function(i,f){var g=this.getFolderList();for(var l in g)if(g[l].id==i)g[l].name=f;u()};this.updateFolderList=
function(i){for(var f in i){for(var g in i[f])i[f][g]=parseInt(i[f][g]);this.getFolderList(f).list=i[f]}u()};this.addToFolderList=function(i,f,g){g=g||false;i=this.getFolderList(i).list;if(a.array.indexOf(i,f)==-1){g?i.unshift(f):i.push(f);u()}};this.restoreConfig=function(){};this.getTheme=function(){return this.configList.theme};this.setTheme=function(i){a.profile("setTheme");if(i){var f={};f.data={retype:1,app:"QQWeb",itemlist:a.json.stringify({theme:i})};alloy.rpcService.sendSetConfig(f);this.configList.theme.id=
i}};this.getWallpaper=function(){return this.configList.wallpaper};this.setWallpaper=function(i){a.profile("setWallpaper");if(i){var f={};f.data={retype:1,app:"QQWeb",itemlist:a.json.stringify({wallpaper:i})};alloy.rpcService.sendSetConfig(f);this.configList.wallpaper=i}};this.getWallpaperList=function(){return this.configList.wallpaperList};this.addWallpaper=function(i){a.array.indexOf(this.configList.wallpaperList,i.id)==-1&&this.configList.wallpaperList.push(i.fileId)};this.removeWallpaper=function(i){a.array.remove(this.getWallpaperList(),
i.fileId)};this.getAppearance=function(){return this.configList.appearance};this.setAppearance=function(i){a.profile("setAppearance");if(i){var f={};f.data={retype:1,app:"QQWeb",itemlist:a.json.stringify({appearance:i})};alloy.rpcService.sendSetConfig(f);this.configList.appearance.id=i}};this.setCustomTheme=function(i,f){a.profile("setCustomTheme");if(i){f=f||"";var g={};g.data={retype:1,app:"QQWeb",itemlist:a.json.stringify({appearance:f,wallpaper:i})};alloy.rpcService.sendSetConfig(g);this.configList.appearance.id=
f;this.configList.wallpaper=i}};this.init=function(){alloy.util.report2h("get_custom","start");a.profile("getCustom");var i={onSuccess:alloy.config.onConfigGetSuc,action:"get_custom",context:this,data:{retype:1,itemlist:a.json.stringify({QQWeb:["theme","wallpaper","wallpaperList","appearance","appBarSetting","setupAppList","isShowTip","quickAppList","folderList","runStatus","chatboxMode","isNotNeedCtrlKey","fontFormat","msgBubblePos","notifySetting"]})}};alloy.rpcService.sendGetConfig(i)};c.__eqqid=
50});
Jx().$package("alloy.businessClass",function(a){var c=a.dom,b=a.event;this.WindowManager=new a.Class({_windowArr:[],_id2Window:{},_preCurrentWindow:null,_currentWindow:null,_windowId:0,_windowType:{},_isDragProxy:false,_isGlobalProxy:false,_useGlobalProxySetting:false,init:function(d){d=d||{};this._defaultContainer=d.defaultContainer;b.addObserver(alloy.layout,"desktopResize",a.bind(this.observer.onWindowResize,this))},observer:{onWindowResize:function(){var d;for(var k in this._windowArr){d=this._windowArr[k];
var t=d.getBoxStatus();t=="max"||t=="fullscreen"?this.adjustSize(d):this.adjustPosition(d)}}},createWindow:function(d,k){var t=this._windowType[d];k.level=k.level?parseInt(k.level):0;k.dragProxy=k.dragProxy||this.getWindowDragProxy();k.zIndex=k.zIndex||alloy.layout.getTopZIndex();k.topMargin=k.topMargin||alloy.layout.getAreaHeight("top");k.bottomMargin=k.bottomMargin||alloy.layout.getAreaHeight("bottom");if(t){if(!k.appendTo&&this._defaultContainer)k.appendTo=this._defaultContainer;k.windowId=this.getWindowId();
d=new t(k);d.setZIndexLevel(k.level);if(!k.x&&!k.y){k=this.getDefaultPosition(d,0,0);d.setXY(k.x,k.y)}else this.adjustPosition(d);this.addWindow(d);k=d.option;k.isSetCurrent?d.setCurrent():d.setNotCurrent();k.isSetCentered&&d.setWindowCentered();switch(k.defaultMode){case "max":d.max();break;case "restore":d.restore();break;case "min":d.min();break}return d}else throw new Error('WindowManager: class "'+d+'" has not register!');},registerWindow:function(d,k){this._windowType[d]=k},addWindow:function(d){this._addObserversToWindow(d);
this._windowArr.push(d);this._id2Window[d.getId()]=d},removeWindow:function(d){if(d==this.getCurrentWindow()){this.setCurrentWindow(null);this._preCurrentWindow&&this._preCurrentWindow.setCurrent()}else if(d==this._preCurrentWindow)this._preCurrentWindow=null;a.array.remove(this._windowArr,d);this._id2Window[d.getId()]=null;delete this._id2Window[d.getId()]},getWindow:function(d){return this._id2Window[d]},getWindowList:function(){return this._windowArr},setCurrentWindow:function(d){if(d)if(this._currentWindow){if(this._currentWindow!=
d){this._preCurrentWindow=this._currentWindow;this._currentWindow.setNotCurrent()}}else this._preCurrentWindow=null;this._currentWindow=d},getCurrentWindow:function(){return this._currentWindow},getTopZIndex:function(d){return alloy.layout.getTopZIndex(d||0)},setWindowZIndex:function(d){var k=this.getTopZIndex(d.getZIndexLevel()||0);d.setZIndex(k)},getWindowId:function(){return this._windowId++},getWindowZIndexLevel:function(d){return d.getZIndexLevel()},setWindowZIndexLevel:function(d,k){d.setZIndexLevel(k)},
adjustPosition:function(d){var k=alloy.layout.getClientWidth(),t=alloy.layout.getClientHeight(),m=alloy.layout.getAreaHeight("top"),q=alloy.layout.getAreaHeight("bottom"),h=d.getX()||0,j=d.getY()||0;if(h+d._width>k){k=k-d._width;h=k<0?0:k;d.setX(h)}if(j+d._height>t-m-q){t=t-d._height-q;j=t<m?m:t;d.setY(j)}},adjustSize:function(d,k,t){k=k||0;t=t||0;var m=alloy.layout.getClientWidth(),q=alloy.layout.getClientHeight(),h=0;if(d.getBoxStatus()=="max"){m=alloy.layout.getAvailableWidth();q=alloy.layout.getAvailableHeight();
h=alloy.layout.getAreaHeight("top")}if(d.windowType=="window"||d.windowType=="chatbox")d.adjustSize(k,t,m,q,0,h)},getDefaultPosition:function(d,k,t){k=k||0;t=t||0;var m=d.option.clientWidth||alloy.layout.getAvailableWidth(),q=d.option.clientHeight||alloy.layout.getAvailableHeight();alloy.layout.getAreaWidth("left");alloy.layout.getAreaWidth("right");var h=alloy.layout.getAreaHeight("top");alloy.layout.getAreaHeight("bottom");var j=m-d._width,p=q-d._height,u=j>0?j/2:0,i=p>0?p/2:0,f=d.getId();f=f<0?
0:f;var g=(u+f*25)%j+k;f=(i+f*25)%p+t;g=g>0?g:0;f=f>0?f:0;g=g+parseInt(d._width)>=m?0:g;f=f+parseInt(d._height)>=q?0:f;f+=h;a.debug("w:"+j+", h:"+p+", w2:"+u+", h2:"+i+", offsetX:"+k+", offsetY:"+t);return{x:g,y:f}},getWindowDragProxy:function(){return this._isDragProxy},setGlobalDragProxyEnabled:function(d,k){this._useGlobalProxySetting=d;this._isGlobalProxy=!!k},getGlobalDragProxyEnabled:function(){return{useGlobal:this._useGlobalProxySetting,isGlobalProxy:this._isGlobalProxy}},_windowObserver:{onWindowSetCenter:function(){var d=
alloy.layout.getAvailableWidth(),k=alloy.layout.getAvailableHeight(),t=alloy.layout.getAreaHeight("top");d=d>this._width?(d-this._width)/2:0;k=k>this._height?(k-this._height)/2:0;k=k<t?t:k;this.setXY(d,k)},onWindowSetCurrent:function(d){if(d.getCurrentWindow()!=this){d.setCurrentWindow(this);d.setWindowZIndex(this)}},onWindowDestroy:function(d){d.removeWindow(this)},onWindowMax:function(){var d=alloy.layout.getAvailableWidth(),k=alloy.layout.getAvailableHeight();this.setXY(0,alloy.layout.getAreaHeight("top"));
this.setWidth(d);this.setHeight(k)},onWindowRestore:function(){},onWindowFullscreen:function(d){var k=alloy.layout.getClientWidth(),t=alloy.layout.getClientHeight();this.setXY(0,0);this.setWidth(k);this.setHeight(t);var m=null;this.setZIndexLevel(3);d.setWindowZIndex(this);m=c.id("fullscreen_tip");if(!m){m=c.node("div",{id:"fullscreen_tip","class":"fullscreen_tip"});document.body.appendChild(m)}c.setStyle(m,"zIndex",alloy.layout.getTopZIndex(3));c.show(m);setTimeout(function(){c.hide(m)},3E3)},onWindowRestoreFull:function(d){this.setZIndexLevel(0);
d.setWindowZIndex(this)},onWindowPin:function(d){this.setZIndexLevel(1);d.setWindowZIndex(this)},onWindowPinOff:function(d){this.setZIndexLevel(0);d.setWindowZIndex(this)}},_addObserversToWindow:function(d){b.addObserver(d,"setCenter",a.bind(this._windowObserver.onWindowSetCenter,d,this));b.addObserver(d,"setCurrent",a.bind(this._windowObserver.onWindowSetCurrent,d,this));b.addObserver(d,"destroy",a.bind(this._windowObserver.onWindowDestroy,d,this));if(d.windowType=="window"||d.windowType=="chatbox"){b.addObserver(d,
"max",a.bind(this._windowObserver.onWindowMax,d,this));b.addObserver(d,"fullscreen",a.bind(this._windowObserver.onWindowFullscreen,d,this));b.addObserver(d,"restorefull",a.bind(this._windowObserver.onWindowRestoreFull,d,this))}if(d.windowType=="widget"){b.addObserver(d,"clickPinUpButton",a.bind(this._windowObserver.onWindowPin,d,this));b.addObserver(d,"clickPinDownButton",a.bind(this._windowObserver.onWindowPinOff,d,this))}},_removeObserversFromWindow:function(d){b.removeObserver(d,"setCenter");b.removeObserver(d,
"setCurrent");b.removeObserver(d,"destroy");b.removeObserver(d,"max");b.removeObserver(d,"fullscreen")}})});
Jx().$package("alloy.businessClass",function(a){var c=a.dom,b=a.event,d=[],k={onWindowClose:function(){t._globalMask&&t._globalMask.hide();d.length>0&&d.shift().show()}},t=new a.Class({_className:"ui_messageBox",init:function(h){h=h||{};var j={title:"\u6e29\u99a8\u63d0\u793a",modeSwitch:true,dragable:true,resize:false,width:370,height:127,innerHtml:"",hasCloseButton:true,isSetCentered:true,modal:false,bodyBorder:1,lineHeight:"inherit",background:"none repeat scroll 0 0 #FFFFFF",level:3};a.extend(j,
h);this.Window=alloy.layout.getWindowManager().createWindow("Window",j);h=this.Window.getId();var p="text-align: center;line-height: "+j.lineHeight+";background:"+j.background+";";if(j.bodyBorder)p+="border:"+j.bodyBorder+"px solid #AAAAAA;";this.Window.setHtml('<div class="'+this._className+'" id="ui_messageBox_'+h+'" style="'+p+'"></div>');this._uiMessageBox=c.id("ui_messageBox_"+h);this._uiMessageBox.innerHTML=j.innerHtml;c.setStyle(this._uiMessageBox,"height",this.Window.getBodyHeight()-j.bodyBorder*
2+"px");b.addObserver(this.Window,"close",k.onWindowClose);if(j.modal){this.modal=true;if(d.length>0){this.Window.hide();d.push(this.Window)}else this.show()}else this.show()},show:function(){var h=this.Window.getZIndexLevel();if(this.modal){if(!t._globalMask)t._globalMask=alloy.layout.getMaskLayer();t._globalMask.setZIndex(alloy.layout.getTopZIndex(h));t._globalMask.show()}this.Window.setZIndex(alloy.layout.getTopZIndex(h));this.Window.show()}}),m=new a.Class({extend:t},{init:function(h){var j={lineHeight:"50px",
hasOkButton:true,autoClose:true};if(h.innerHtml.length>34)h.lineHeight="25px";a.extend(j,h);m.superClass.init(j);j.onAccept&&b.addObserver(this.Window,"clickOkButton",function(){j.onAccept.apply(this);j.autoClose&&this.close()})}}),q=new a.Class({extend:t},{init:function(h){var j={lineHeight:"50px",hasOkButton:true,hasCancelButton:true,autoClose:true};if(h.innerHtml.length>34)h.lineHeight="25px";a.extend(j,h);q.superClass.init(j);var p=false;j.onAccept&&b.addObserver(this.Window,"clickOkButton",function(){j.onAccept.apply(this);
p=true;j.autoClose&&this.close()});j.onCancel&&b.addObserver(this.Window,"close",function(){p||j.onCancel.apply(this)})}});this.MessageBox=t;this.MessageBox.Alert=m;this.MessageBox.Confirm=q});
Jx().$package("alloy.businessClass",function(a){var c=a.dom,b=a.event,d,k,t=function(){d=null},m=function(h){h.preventDefault();alloy.portal.setReRunAppList([k.id]);k.loginLevel>2?alloy.layout.showLoginWindow(k.id,true):alloy.layout.showLoginWindow(k.id,false);d.close()},q=function(h){alloy.rpcService.sendGetDefaultAppIntroduce({appid:[h],loadMethod:3,val:["appName","appDesc","id"]},function(j){if(j.retcode===0){k=j=j.result.resultData[h];var p='Hi\uff0c\u60a8\u8fd8\u6ca1\u6709\u767b\u5f55\u54e6\uff0c\u8d76\u5feb<a id="portal_login_btn" style="font-size:14px;font-weight:bold;" href="###">\u767b\u5f55</a>\u5c1d\u8bd5\u4e00\u4e0b\u5427\uff01';
if(h=="messageBox"||h=="buddyManager")p='Hi\uff0c\u6b64\u5e94\u7528\u9700\u8981\u767b\u5f55QQ\uff0c\u8d76\u5feb<a id="portal_login_btn" style="font-size:14px;font-weight:bold;" href="###">\u767b\u5f55</a>\u5c1d\u8bd5\u4e00\u4e0b\u5427\uff01';p='<div class="content_area" style="_height:406px"><div class="intro_window_wrap">\t\t        <div id="intro_window_area" class="intro_window_area" title="'+a.string.encodeHtmlAttributeSimple(String(j.appDesc))+'">\t\t            <h3>'+a.string.encodeHtmlSimple(String(j.appName))+
'</h3><span style="text-align:left;">'+a.string.encodeHtmlSimple(String(j.appDesc))+'</span></div>\t\t        <div style="margin-top:50px; text-align: center; font-weight: bold; font-size:14px;">'+p+"</div>\t\t        </div></div>";var u={title:j.appName,width:545,height:450,level:0,setCenter:1};d&&d.close();d=alloy.layout.messagebox(p,u);p=c.id("intro_window_area");c.setStyle(p,"backgroundImage","url(./module/appmarket/images/thumb_"+j.id+".png)");j=c.id("portal_login_btn");b.on(j,"click",m);b.addObserver(d,
"close",t)}})};this.App=new a.Class({init:function(h){h.id||a.out("App: ["+h.appName+"] \u7f3a\u5c11 id !!!");this.option={id:h.id,title:h.appName||"\u672a\u547d\u540d\u5e94\u7528",appType:h.appType||1,appUrl:h.appUrl||null,windowMode:h.windowMode||"single",x:h.x,y:h.y,width:h.width||600,height:h.height||500,hasCloseButton:a.isUndefined(h.hasCloseButton)?true:h.hasCloseButton,hasMaxButton:a.isUndefined(h.hasMaxButton)?true:h.hasMaxButton,hasMinButton:a.isUndefined(h.hasMinButton)?true:h.hasMinButton,
hasOkButton:h.hasOkButton||false,hasCancelButton:h.hasCancelButton||false,hasRefreshButton:h.hasRefreshButton?true:false,modeSwitch:a.isUndefined(h.modeSwitch)?true:h.modeSwitch,dragable:a.isUndefined(h.dragable)?true:h.dragable,dragProxy:a.isUndefined(h.dragProxy)?alloy.layout.getWindowManager().getWindowDragProxy():h.dragProxy,resize:a.isUndefined(h.resize)?true:h.resize,defaultMode:a.isUndefined(h.defaultMode)?"restore":h.defaultMode,flashMode:a.isUndefined(h.flashMode)?false:h.flashMode,loginLevel:a.isUndefined(h.loginLevel)?
alloy.CONST.LOGIN_LEVEL_NONE:h.loginLevel,customLoginValidate:h.customLoginValidate,alterMode:a.isUndefined(h.alterMode)?false:h.alterMode,ieOnly:a.isUndefined(h.ieOnly)?false:h.ieOnly};if(a.browser.mobileSafari&&this.option.id===15)this.option.appUrl="http://live.qq.com/ipad/";a.out("id:"+this.option.id+", hasCloseButton:"+this.option.hasCloseButton);this._isRunning=false;b.notifyObservers(this,"init",this)},detectActiveX:function(){var h=null;try{h=new ActiveXObject("TXFTNActiveX.FTNUpload")}catch(j){return false}if(h){var p=
"";try{p=h&&(h.version?h.version:"1.0.0.8")||""}catch(u){}if(!p)return false;return parseInt(p.split(".").join(""))>1007?true:false}else return false},run:function(h){var j=this;this.runOption=h=h||{};a.extend(this.option,h);if(a.platform.iPad)switch(parseInt(this.option.id)){case 5:case 9:case 11:case 13:case 24:case 26:case 27:case 30:case 35:case 36:case 37:case 39:alloy.layout.alert("\u5f88\u62b1\u6b49\uff0c\u6b64\u5e94\u7528\u6682\u4e0d\u652f\u6301iPad\u3002");return}var p=alloy.portal.getLoginLevel();
if(!h.noValidateLogin&&this.option.loginLevel>p)this.option.customLoginValidate?b.notifyObservers(this,"needLogin",{has:this.option.loginLevel,need:p}):q(this.option.id);else if(this.option.id=="56"&&!a.browser.mobileSafari&&a.browser.ie!=9)alloy.layout.alert("\u5f88\u62b1\u6b49\uff0c\u6b64\u5e94\u7528\u6682\u65f6\u4e0d\u652f\u6301\u8be5\u6d4f\u89c8\u5668\u3002");else if(a.browser.ie&&this.option.id=="13"&&!this.detectActiveX())alloy.layout.alert("\u6b64\u5e94\u7528\u9700\u8981\u63d2\u4ef6\u652f\u6301\uff0c\u70b9\u51fb\u786e\u5b9a\u83b7\u53d6\u5b89\u88c5",
function(){this.body.innerHTML+='<div><object classid="clsid:BDEACC50-F56D-4D60-860F-CF6ED1766D65" codebase="http://res.qqmail.com/zh_CN/activex/TencentMailActiveX.cab#version=1,0,1,32"></object></div>';this.close()},{autoClose:false});else if(this.option.id=="25")alloy.layout.messagebox("<div class='flash_alt' style='display: block;'><div class='appIframeAlter'></div><div class='appComingSoon'></div></div>",{title:this.option.title,width:600,height:450});else if(this.option.ieOnly&&!a.browser.ie||
a.browser.ie&&this.option.id=="13"&&!this.detectActiveX())alloy.layout.alert("\u5f88\u62b1\u6b49\uff0c\u6b64\u5e94\u7528\u4ec5\u652f\u6301ie\u6d4f\u89c8\u5668\u3002");else{if(this.isRunning())b.notifyObservers(this,"runAgain",h);else{this._isRunning=true;this.option.windowMode!=="none"&&this.createWindow(h);if(this.option.appType!==1)if(this.option.appType===2){var u=alloy.layout.getWindowManager().getCurrentWindow();if((!this.option.ieOnly||a.browser.ie)&&(!a.browser.ie||this.option.id!="13"||this.detectActiveX())){this.window.setHtml('\t\t\t\t\t\t\t<div id="container_iframeApp_'+
this.window.getId()+'" class="content_area">\t\t\t\t\t\t\t\t<iframe id="iframeApp_'+this.window.getId()+'" class="iframeApp" src="about:blank" frameborder="no" allowtransparency="true" scrolling="auto" hidefocus ></iframe>\t\t\t\t\t\t\t\t<div id="iframeApp_dragResizeMask_'+this.window.getId()+'" class="iframeDragResizeMask"></div>\t\t\t\t\t\t\t</div>\t\t\t\t\t\t');this._contenty=this._contentx=0;this._iframe=c.id("iframeApp_"+this.window.getId());this._iframeDragResizeMask=c.id("iframeApp_dragResizeMask_"+
this.window.getId());this._containerIframe=c.id("container_iframeApp_"+this.window.getId());a.platform.iPad&&c.addClass(this._containerIframe,"ipad");if(this.option.alterMode){j.alterDom=c.node("div",{"class":"flash_alt"});j.alterDom.innerHTML="<div class='appIframeAlter'></div><div  class='appIframeAlterTxt'>\u8fd0\u884c\u4e2d\uff0c\u70b9\u51fb\u6062\u590d\u663e\u793a :)</div>";this.window.body.appendChild(j.alterDom)}b.on(this._iframe,"load",function(){b.notifyObservers(j,"load")});this._iframe.src=
h&&h.appUrl||this.option.appUrl;var i={onWindowResize:function(l){j.option.flashMode&&j.window!=u||j._resizeIframe(l)},onWindowShow:function(l){if(!a.isUndefined(j.window._x)){j.window.setX(j.window._x);delete j.window._x}l=j.window.getBodySize();j._resizeIframe(l)},onWindowDragStart:function(){a.platform.iPad||c.show(j._iframeDragResizeMask)},onWindowDragEnd:function(){c.hide(j._iframeDragResizeMask)},onSetCurrent:function(){c.setStyle(j._containerIframe,"height","99%");c.setStyle(j._containerIframe,
"width","100%");i.onWindowShow();c.hide(j.alterDom)},onSetNotCurrent:function(){if(!a.platform.iPad){c.setStyle(j._iframe,"width","1px");c.setStyle(j._iframe,"height","1px");c.setStyle(j._containerIframe,"width","1px");c.setStyle(j._containerIframe,"height","1px");c.show(j.alterDom)}},onWindowMin:function(){if(j.option.flashMode){var l=j.window.getX();j.window._x=l;j.window.setX(-10000);j.window._x=l}}};this._resizeIframe=function(l){if(!a.platform.iPad){c.setStyle(this._iframe,"width",l.width-2+
"px");c.setStyle(this._iframe,"height",l.height-2+"px")}};if(this.option.alterMode){b.addObserver(this.window,"setCurrent",i.onSetCurrent);b.addObserver(this.window,"setNotCurrent",i.onSetNotCurrent);b.addObserver(this.window,"dragStart",i.onSetNotCurrent);b.addObserver(this.window,"dragEnd",i.onSetCurrent)}else{b.addObserver(this.window,"setNotCurrent",i.onWindowDragStart);b.addObserver(this.window,"setCurrent",i.onWindowDragEnd)}this.option.flashMode&&b.addObserver(this.window,"min",i.onWindowMin);
b.addObserver(this.window,"resize",i.onWindowResize);b.addObserver(this.window,"show",i.onWindowShow)}p=document.getElementById("iframeApp_"+u.getId());var f=false;try{f=p&&typeof p.contentWindow.padEventProxy=="function"?true:false}catch(g){}a.platform.iPad&&!f&&new a.ui.IframeScroller(this._iframe)}p=function(){j.window.setCurrent()};this.option.windowMode==="single"&&b.addObserver(this,"runAgain",p);b.notifyObservers(this,"runFirst",h);b.addObserver(this,"appExit",j.exit)}b.notifyObservers(alloy.portal,
"appRun",this.option.id);b.notifyObservers(this,"run",h)}},createWindow:function(h){var j=this;h=h||{};var p=alloy.layout.getWindowManager().createWindow("Window",{appId:j.option.id,flashMode:j.option.flashMode,loginLevel:j.option.loginLevel,title:j.option.title,modeSwitch:j.option.modeSwitch,dragProxy:j.option.dragProxy,dragable:j.option.dragable,resize:j.option.resize,x:h.x||j.option.x,y:h.y||j.option.y,width:h.width||j.option.width,height:h.height||j.option.height,defaultMode:j.option.defaultMode,
hasRefreshButton:j.option.hasRefreshButton,hasCloseButton:j.option.hasCloseButton,hasMaxButton:j.option.hasMaxButton,hasMinButton:j.option.hasMinButton,hasOkButton:j.option.hasOkButton,hasCancelButton:j.option.hasCancelButton,alterMode:j.option.alterMode,ieOnly:j.option.ieOnly,appType:j.option.appType});this.window=p;h={onWindowClose:function(){if(j._iframe)j._iframe.src="about:blank";j.destroy()},onExit:function(){b.notifyObservers(p,"closeWindow",p)}};b.addObserver(p,"close",h.onWindowClose);b.addObserver(this,
"exit",h.onExit);return p},setCurrent:function(){b.notifyObservers(this,"setCurrent");this.window&&this.window.setCurrent()},getCurrent:function(){return null},isRunning:function(){return this._isRunning},getRunOpiton:function(){return this.runOption},exit:function(){b.notifyObservers(this,"exit");this.destroy()},destroy:function(){b.notifyObservers(this,"destroy");this._isRunning=false;b.notifyObservers(alloy.portal,"appExit",this.option.id)},updateAppConfig:function(h){var j=this;if(h.id==j.option.id){a.extend(j.option,
h);j._isRunning&&h.type==2&&j.window.setTitle(h.appName)}},removeAppConfig:function(){var h=this;if(h._iframe)h._iframe.src="about:blank";h.exit()},touchMoveHandler:function(h){var j=this._iframe,p=this._containerIframe,u=this._contentx+h.sx;h=this._contenty+h.sy;var i=c.getWidth(j),f=c.getHeight(j),g=c.getWidth(p);p=c.getHeight(p);if(u>0)u=0;else if(u<g-i)u=g-i;if(h>0)h=0;else if(h<p-f)h=p-f;c.setStyle(j,"left",u+"px");c.setStyle(j,"top",h+"px");this._contentx=u;this._contenty=h}})});
Jx().$package("alloy.portal",function(a){var c=this,b=a.event,d=a.http,k,t=false,m,q=alloy.CONST.LOGIN_LEVEL_NOCHAT,h=1,j,p=false,u=false,i="",f,g,l="",r="",v=null,y=0,B=false,E,D,I,L=true;c.speedTest=alloy.util.speedTest;this.setPortalSelf=function(n){c.self.uin=n.uin||c.getUin();c.self.allow=n.allow;c.self.age=n.age;c.self.nick=n.nick;c.self.htmlNick=a.string.encodeHtml(String(n.nick));c.self.titleNick=String(n.nick);c.self.country=n.country;c.self.province=n.province;c.self.city=n.city;c.self.gender=
n.gender;c.self.face=n.face;c.self.phone=n.phone;c.self.mobile=n.mobile;c.self.email=n.email};this.setPortalSelfItem=function(n,w){c.self[n]=w};this.getPortalSelf=function(n){return typeof c.self=="undefined"?{}:typeof n=="undefined"?c.self:c.self[n]};var N=function(){a.profile("runCoreApps Start!","portal!");c.runApp("myPanel",{callback:function(){alloy.app.taskBar.run();alloy.app.appBar.run();alloy.app.tips.run();c.runApp("bubbleTip");aa();T()}});a.profile("runCoreApps Finish!","portal!")},J=function(){var n=
c.getLoginLevel(),w;if(n==1)w="panel";else if(n==2)w="go";else if(n==3)w="logined";return w},O=function(){a.profile("runDefaultApps Start!","portal!");for(var n=R(),w=c.getLoginLevel(),A=0;A<n.length;++A)if(n[A]==alloy.config.__eqqid){if(w!=3){var C=J();a.debug("run EQQ in [runDefaultApps],level:"+w+": "+C,"_plogin");c.runApp(alloy.config.__eqqid,{loginMode:C})}}else c.runApp(n[A]);a.profile("runDefaultApps Finish!","portal!")},P=function(){a.profile("runAppsInRunStatus Start!","portal!");for(var n=
alloy.config.configList.runStatus,w=c.getLoginLevel(),A=0;A<n.appList.length;A++){var C=n.appList[A];if(C.appId==alloy.config.__eqqid)if(w==2){var H=J();a.debug("run EQQ in [runAppsInRunStatus],level:"+w+": "+H,"_plogin");alloy.portal.runApp(alloy.config.__eqqid,{defaultMode:C.defaultMode,x:C.x,y:C.y,width:C.width,height:C.height,loginMode:H})}else{if(w==3){H="update";a.debug("run EQQ in [runAppsInRunStatus],level:"+w+": "+H,"_plogin");alloy.portal.runApp(alloy.config.__eqqid,{defaultMode:C.defaultMode,
x:C.x,y:C.y,width:C.width,height:C.height,loginMode:H})}}else alloy.portal.runApp(C.appId,{defaultMode:C.defaultMode,x:C.x,y:C.y,width:C.width,height:C.height})}n.currentApp&&c.runApp(n.currentApp);a.profile("runAppsInRunStatus Finish!","portal!")};this.setReRunAppList=function(n){I=n};var Q=function(){a.profile("reRunBeforeLoginApps Start!","portal!");if(I){for(var n=0;n<I.length;++n){var w=I[n],A=c.getApp(w);if(A&&!A.isRunning())if(w==alloy.config.__eqqid){w=J();a.debug("run EQQ in [reRunBeforeLoginApps],level:"+
c.getLoginLevel()+": "+w,"_plogin");c.runApp(alloy.config.__eqqid,{loginMode:w})}else c.runApp(w)}c.setReRunAppList([])}a.profile("reRunBeforeLoginApps Finish!","portal!")},R=function(){return["18","19","20",alloy.config.__eqqid]},s=function(){return["56"]},o=function(){a.profile("runPopApps Start!","portal!");for(var n=s(),w=0;w<n.length;++w)switch(n[w]){case "56":break;default:break}a.profile("runPopApps Finish!","portal!")},x=function(){var n=a.string.mapQuery(window.location.search).run||"";if(n)return a.json.parse(n)},
z=function(){var n=x();if(a.isObject(n))for(var w in n){n[w].runFrom="url";alloy.portal.runApp(w,n[w])}},F=function(){a.cookie.remove("ptwebqq",alloy.CONST.MAIN_DOMAIN);a.cookie.remove("skey",alloy.CONST.MAIN_DOMAIN);a.cookie.remove("uin",alloy.CONST.MAIN_DOMAIN);a.cookie.remove("vfwebqq",alloy.CONST.MAIN_DOMAIN)},G=function(){a.profile("reset start!","portal!");ba();b.notifyObservers(alloy.portal,"reset",c.getLoginLevel());a.profile("reset finish!","portal!")},K=function(){q=c.getUin()&&c.getSkey()?
2:1},aa=function(){a.profile("initAccount start!","portal!");i=c.getOriginalCookieUin();r=c.getCookieSkey();l=c.getCookiePtwebqq();f=c.getCookieUin();K();a.profile("initAccount finish!","portal!")},ca=function(){i=c.getOriginalCookieUin();r=c.getCookieSkey();l=c.getCookiePtwebqq();c.setUin(c.getCookieUin())},T=function(){D=j=true;a.profile("tryLogin start, tryLoginLevel:"+q,"portal!");qqweb.util.report2h("pass_ptlogin","start");if(q==alloy.CONST.LOGIN_LEVEL_ALL){c.setLoginLevel(alloy.CONST.LOGIN_LEVEL_ALL);
if(U())G();else D=false;a.debug("run EQQ in [tryLogin],tryLoginLevel:"+q+": logined","_plogin");c.runApp(alloy.config.__eqqid,{loginMode:"logined"})}else if(q==alloy.CONST.LOGIN_LEVEL_NOCHAT){alloy.util.report2h("get_vfwebqq","start");alloy.rpcService.sendGetVfWebQQ(c.getUin())}else V();a.profile("tryLogin finish!","portal!")},V=function(){b.notifyObservers(c,"UACReady")},ba=function(){var n=c.getRunningAppStatus();if(n)for(var w=0;w<n.appList.length;w++){var A=n.appList[w].appId;if(~~A)A="app"+A;
(A=alloy.app[A])&&A.isRunning()&&A.exit()}},da=function(){y==1&&z();alloy.config.configList.runStatus?P():O();Q();o()},U=function(){if(c.getUin()===c.getOldUin()){a.debug("uin not change: "+c.getUin(),"_plogin");return false}else{a.debug("uin change: "+c.getOldUin()+" -> "+c.getUin(),"_plogin");return true}},W=function(){if(h===m){a.debug("loginLevel not change: "+h,"_plogin");return false}else{a.debug("loginLevel change: "+m+" -> "+h,"_plogin");return true}},X=function(){t||alloy.portal.recoverCookie()},
M={onPortalReady:function(n){p=true;y++;a.profile("onPortalReady, portalReadyCount:"+y+", level:"+n,"portal!");if(U()||y==1)da();if(y==1){setTimeout(function(){alloy.layout.hideStartingCover()},1E3);try{if(typeof pgvMain=="function"){pvRepeatCount=1;pgvMain("",{virtualURL:alloy.CONST.DOMAIN})}qqweb.util.report2h("portal","end","ok");qqweb.portal.speedTest.sRTS(8,"end",new Date,true)}catch(w){}}},onExitSuccess:function(){location.reload()},onGetVfWebQQError:function(){a.profile("onGetVfWebQQError",
"portal!");qqweb.util.report2h("get_vfwebqq","end","error");c.setLoginLevel(qqweb.CONST.LOGIN_LEVEL_NONE);V()},onGetVfWebQQSuccess:function(n){c.setLoginLevel(alloy.CONST.LOGIN_LEVEL_NOCHAT);v=n.result&&n.result.length===2&&n.result[0]=="vfwebqq"?n.result[1]:null;a.profile("onGetVfWebQQSuccess, vfwebqq:"+v,"portal!");qqweb.util.report2h("get_vfwebqq","end","ok");G();b.notifyObservers(alloy.portal,"GetLoginInfoSuccess")},onGetLoginInfoSuccess:function(){qqweb.util.report2h("pass_ptlogin","end","ok")},
onSelfInfoReady:function(){a.profile("onSelfInfoReady","portal!");if(j){j=false;if(D){D=false;alloy.config.init()}else W()&&Q()}},onReset:function(){},onGetAppConfigComplete:function(){var n=c.getLoginLevel();a.profile("onGetAppConfigComplete","portal!");try{b.notifyObservers(alloy.portal,"portalReady",n)}catch(w){a.error("portalReady, but [portalReady notify] error, level:"+n)}},onUpdateAppConfig:function(n){var w=c.getApp(n.id);w&&w.updateAppConfig(n)},onRemoveAppConfig:function(n){var w=c.getApp(n.id);
w&&w.removeAppConfig(n);delete alloy.app["app"+n.id];c.setAppLoading(n.id,false)}};this.init=function(){k={};E=0;b.addObserver(alloy.portal,"exitSuccess",M.onExitSuccess);b.addObserver(alloy.rpcService,"GetVfWebQQError",M.onGetVfWebQQError);b.addObserver(alloy.rpcService,"GetVfWebQQSuccess",M.onGetVfWebQQSuccess);b.addObserver(alloy.portal,"GetLoginInfoSuccess",M.onGetLoginInfoSuccess);b.addObserver(alloy.portal,"selfInfoReady",M.onSelfInfoReady);b.addObserver(alloy.portal,"reset",M.onReset);b.addObserver(alloy.appconfig,
"GetAppConfigComplete",M.onGetAppConfigComplete);b.addObserver(alloy.appconfig,"GetDefaultAppConfigComplete",M.onGetAppConfigComplete);b.addObserver(alloy.appconfig,"UpdateAppConfig",M.onUpdateAppConfig);b.addObserver(alloy.appconfig,"RemoveAppConfig",M.onRemoveAppConfig);b.addObserver(alloy.portal,"portalReady",M.onPortalReady);alloy.layout.init();alloy.sound.init();alloy.layout.themeManager.init();alloy.portal.messageCenter.init();b.addObserver(alloy.layout,"clickDesktop",X);b.addObserver(alloy.layout,
"desktopFocus",X);N();qqweb.util.report2h("portal","end_runCoreApps","ok")};this.getPtwebqq=function(){return l};this.setPtwebqq=function(n){return l=n};this.getOldUin=function(){return g};this.getUin=function(){return f};this.getOriginalUin=function(){return i};this.getSkey=function(){return r};this.getLoginLevel=function(){return h};this.setLoginLevel=function(n){m=h;h=n;W()&&b.notifyObservers(alloy.portal,"loginLevelChange",n)};this.isPortalReady=function(){return p};this.setUin=function(n){g=
f;return f=n};this.recoverCookie=function(){};this.validatePTLoginSuccess=function(n){n=n||{};n=a.string.mapQuery(n.url);q=Number(n.login_level);a.profile("validatePTLoginSuccess, tryLoginLevel:"+q,"portal!");alloy.util.report2h("pass_ptlogin","start");ca();T();alloy.layout.hideLoginWindow()};this.getCookieUin=function(){var n=a.cookie.get("uin",alloy.CONST.MAIN_DOMAIN);n=n?parseInt(n.substr(1),10):null;a.out("Cookie uin:"+n);return n};this.getOriginalCookieUin=function(){return a.cookie.get("uin",
alloy.CONST.MAIN_DOMAIN)};this.getCookieSkey=function(){return a.cookie.get("skey",alloy.CONST.MAIN_DOMAIN)};this.getCookiePtwebqq=function(){return a.cookie.get("ptwebqq",alloy.CONST.MAIN_DOMAIN)};this.runApp=function(n,w){var A=this.getAllConfig(n);if(!A){a.out("id:"+n);return false}var C=this.getApp(n);if(C){C.run&&C.run(w);w&&a.isFunction(w.callback)&&w.callback()}else if(A)if(A.appType==1)this.loadApp(A,w);else if(A.appType==2){if(~~n>0)alloy.app["app"+n]=new alloy.businessClass.App(A);else alloy.app[n]=
new alloy.businessClass.App(A);alloy.portal.runApp(n,w)}if(A)L=false;return true};this.loadApp=function(n,w){n=n||{};if(!this.getAppLoading(n.id)){this.setAppLoading(n.id,true);var A=n.id,C=alloy.util.getAppRoot(A),H=C+(n.css||"style.css");C=C+(n.js||"main.js");if(n.css||a.isNumber(A))d.loadCss(H+"?"+alloy.CONST.UPDATE_TIME_STAMP);d.loadScript(C+"?"+alloy.CONST.UPDATE_TIME_STAMP,{onSuccess:function(){alloy.portal.runApp(n.id,w)}})}};this.getAppConfigList=function(){return alloy.appconfig.appConfigList};
this.getAppConfig=function(n){return alloy.appconfig.getAppConfig(n)};this.getSystemConfig=function(n){return alloy.appconfig.getSystemConfig(n)};this.getAllConfig=function(n){return alloy.appconfig.getAllConfig(n)};this.getApp=function(n){return~~n>0?alloy.app["app"+n]:alloy.app[n]};this.setAppLoading=function(n,w){return k[n]=w};this.getAppLoading=function(n){return k[n]};this.setIsDownloading=function(n){u=n};this.getIsDownloading=function(){return u};this.closeHook=function(n){if(a.browser.ie==
6&&u)return u=false;else WebqCore.api.log("browser-close");var w="\u60a8\u786e\u8ba4\u8981\u79bb\u5f00 WebQQ \u5417\uff1f";if(c.getLoginLevel()<alloy.CONST.LOGIN_LEVEL_ALL)w="\u6267\u884c\u6b64\u64cd\u4f5c\u53ef\u80fd\u4f1a\u4e22\u5931\u9875\u9762\u4e2d\u7684\u4fe1\u606f\uff0c\u786e\u8ba4\u7ee7\u7eed\uff1f";pgvSendClick({hottag:"web2qq.qqpanel.status.exitQQ"});if(a.browser.safari||a.browser.chrome)return w;else if(a.browser.ie>0)window.event.returnValue=w;else n.returnValue=w};var ea=function(){if(EQQ&&
EQQ.getIsLogin()){EQQ.logout();WebqCore.api.log("browser-close-ok");EQQ.RPCService._proxy&&EQQ.RPCService._proxy.abort();EQQ.View.ChatBox&&EQQ.View.ChatBox.scaptureHotkey&&EQQ.View.ChatBox.scaptureHotkey.unstall()}};this.addCloseHook=function(){if(!B){B=true;b.on(window,"beforeunload",this.closeHook);b.on(window,"unload",ea)}};this.removeCloseHook=function(){b.off(window,"beforeunload");B=false};this.getCloseHook=function(){return B};this.addExitConfirm=function(n){E+=n||1;E>0&&this.addCloseHook();
return E};this.removeExitConfirm=function(n){E-=n||1;E<1&&this.removeCloseHook();return E};this.getExitConfirm=function(){return E};var Y=function(){var n=alloy.layout.getWindowManager().getCurrentWindow(),w="";if(n)w=n.getAppId();b.notifyObservers(alloy.portal,"exit");t=true;F();a.out(">>>>> cookie.remove");alloy.layout.hideDesktop();setTimeout(function(){b.notifyObservers(alloy.portal,"exitSuccess")},1E3);L&&pgvSendClick({hottag:"WEB2QQ.NOAPP.USER.ALL"})};this.exit=function(){this.getExitConfirm()>
0?alloy.layout.confirm("\u60a8\u786e\u8ba4\u8981\u79bb\u5f00 WebQQ \u5417\uff1f",function(){c.removeCloseHook();pgvSendClick({hottag:"web2qq.qqpanel.status.exitQQ"});Y()}):Y()};this.getVfWebQQ=function(){return typeof EQQ!=="undefined"&&EQQ.getVfWebQQ&&EQQ.getVfWebQQ()&&EQQ.getIsLogin()?EQQ.getVfWebQQ():v?v:""};this.getRunningAppStatus=function(){var n=alloy.layout.getWindowManager(),w=n.getCurrentWindow(),A="",C;if(w)A=w.getAppId();w={currentAppId:A,appList:[]};n=n.getWindowList();for(A=0;A<n.length;A++){var H=
n[A],S=H.getAppId();if(!(S==="eqq--"||S==="sceneChristmas")){C=H.getX();var Z=H.getY();if(H.windowType==="window"){var $=H.getBoxStatus();if($!=="min"){var fa=H.getWidth();H=H.getHeight();C={appId:S,defaultMode:$,x:C,y:Z,width:fa,height:H};S&&w.appList.push(C)}}else if(H.windowType==="widget"){C={appId:S,x:C,y:Z};w.appList.push(C)}}}return w};this.openInWebBrowser=function(n){n=n||{};var w=this.getApp(6);if(a.isUndefined(w)||!w.isRunning()){n.isOpenNewTab=true;return alloy.portal.runApp("6",n)}else{w.openUrl(n);
n.callback&&n.callback();return true}};this.addNotificationSource=function(n,w,A){alloy.portal.messageCenter&&alloy.portal.messageCenter.addNotificationSource(n,w,A)};this.removeNotificationSource=function(n){alloy.portal.messageCenter&&alloy.portal.messageCenter.removeNotificationSource(n)}});
Jx().$package("alloy.portal.messageCenter",function(a){var c=a.event,b=this,d={},k=[],t=function(h){return h.uin+h.type},m=function(h){for(var j in h){a.out("MessageCenter MessageReceive!");var p=h[j],u=t(p);if(d[u]){if(p.resetCount)d[u].count=1;else if(d[u].msg.resetCount)d[u].count=1;else d[u].count++;d[u].msg=p}else d[u]={id:u,msg:p,count:1};var i="";switch(p.type){case "single":i="Single";break;case "group":i="Group";break;case "system":i="System";break;case "mail":i="Mail";break;default:i="Other";
break}try{a.out("MessageCenter NotifyMessage! - "+u);c.notifyObservers(b,i+"MessageReceive",d[u])}catch(f){a.error("MessageCenter NotifyMessageError! - "+u+"\nErrorInfo: "+f,"MessageCenter")}}},q=function(h){var j=t(h.msg);if(!h.id)h.id=j;if(d[j]){d[j]=null;delete d[j];for(var p in k)if(!(h.ignoreEvent&&h.ignoreEvent==k[p].cbEvent)){a.out("MessageCenter MessageHasHandled To targetModel - "+k[p].cbEvent);c.notifyObservers(k[p].target,k[p].cbEvent,h.msg)}try{a.out("MessageCenter MessageHasHandled To View - "+
j);c.notifyObservers(b,"MessageHandled",h)}catch(u){a.error("MessageCenter MessageHasHandled Error! - "+j+"\nErrorInfo: "+u,"MessageCenter")}}};this.init=function(){};this.addNotificationSource=function(h,j,p){p={target:h,event:j,cbEvent:p};c.addObserver(h,j,m);k.push(p);alloy.portal.messageCenter.notifier.isInit()||alloy.portal.messageCenter.notifier.init()};this.removeNotificationSource=function(h){if(h){for(var j in k){var p=k[j];if(h==p.target){k.splice(j,1);c.removeObserver(p.target,p.event,
m);break}}for(var u in d){j=d[u];if(h==j.msg.targetModel){d[u]=null;delete d[u];q.apply(b,[j])}}}};this.handleNotification=function(h){q.apply(b,[h])}});
Jx().$package("alloy.portal.messageCenter.notifier",function(a){var c=a.event,b=a.string,d=false;this.CONST={ENABLE_TITLE_MARQUEE:1,ENABLE_MSG_BUBBLE:2,ENABLE_DESKTOP_NOTIFICATION:4,ENABLE_SOUND:8};this.init=function(){if(!d){d=true;this.soundNotify=new k;this.titleMarquee=new t;alloy.app.msgBubble.run();this.desktopNotification=new m;if(a.browser.ie==9)this.desktopNotification2=new q}};this.isInit=function(){return d};var k=new a.Class({init:function(){c.addObserver(alloy.portal.messageCenter,"SingleMessageReceive",
a.bind(this.observer.onSingleMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"GroupMessageReceive",a.bind(this.observer.onGroupMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"SystemMessageReceive",a.bind(this.observer.onSystemMessageReceive,this))},checkIsNeedSound:function(h){if(!h.msg.isAllow)return false;return true},observer:{onSingleMessageReceive:function(h){this.checkIsNeedSound(h)&&alloy.sound.playSound("./sound/msg.mp3",true)},onGroupMessageReceive:function(h){this.checkIsNeedSound(h)&&
alloy.sound.playSound("./sound/msg.mp3",true)},onSystemMessageReceive:function(h){this.checkIsNeedSound(h)&&alloy.sound.playSound("./sound/system.mp3",true)}}}),t=new a.Class({init:function(){this._isFocusOnDesktop=true;this._enableFlag=alloy.portal.messageCenter.notifier.CONST.ENABLE_TITLE_MARQUEE;c.addObserver(alloy.portal.messageCenter,"SingleMessageReceive",a.bind(this.observer.onSingleMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"GroupMessageReceive",a.bind(this.observer.onGroupMessageReceive,
this));c.addObserver(alloy.portal.messageCenter,"SystemMessageReceive",a.bind(this.observer.onSystemMessageReceive,this));c.addObserver(alloy.layout,"clickDesktop",this.observer.onDesktopFocus);c.addObserver(alloy.layout,"desktopFocus",a.bind(this.observer.onDesktopFocus,this));c.addObserver(alloy.layout,"desktopBlur",a.bind(this.observer.onDesktopBlur,this))},checkIsNeedMarquee:function(h){var j=alloy.config.configList.notifySetting;if(!a.isUndefined(j)&&!(j&this._enableFlag))return false;if(this._isFocusOnDesktop)return false;
if(!h.msg.isAllow)return false;return true},observer:{onSingleMessageReceive:function(h){if(this.checkIsNeedMarquee(h)){h=h.msg.title||h.uin||"";h=b.decodeHtmlSimple(h);h=h+" - \u6765\u6d88\u606f\u4e86...";alloy.layout.resetTitle();alloy.layout.setTitle(h,{roll:true})}},onGroupMessageReceive:function(h){if(this.checkIsNeedMarquee(h)){h=h.msg.title||h.uin||"";h=b.decodeHtmlSimple(h);h=h+" - \u6765\u6d88\u606f\u4e86...";alloy.layout.resetTitle();alloy.layout.setTitle(h,{roll:true})}},onSystemMessageReceive:function(h){if(this.checkIsNeedMarquee(h)){alloy.layout.resetTitle();
alloy.layout.setTitle("\u60a8\u6709\u65b0\u7684\u7cfb\u7edf\u6d88\u606f...",{roll:true})}},onDesktopFocus:function(){this._isFocusOnDesktop=true;this._currentTitleMsg=null;a.browser.chrome?setTimeout(function(){alloy.layout.resetTitle()},100):alloy.layout.resetTitle()},onDesktopBlur:function(){this._isFocusOnDesktop=false}}}),m=new a.Class({init:function(){var h=new a.ui.Notifier;if(h.hasSupport()){h.requestPermission();this._notifier=h;this._notifierManage=[];this._popupHideTime=5E3;this._enableFlag=
alloy.portal.messageCenter.notifier.CONST.ENABLE_DESKTOP_NOTIFICATION;c.addObserver(alloy.portal.messageCenter,"SingleMessageReceive",a.bind(this.observer.onChatMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"GroupMessageReceive",a.bind(this.observer.onChatMessageReceive,this))}},checkIsNeedNotify:function(h){var j=alloy.config.configList.notifySetting;if(!a.isUndefined(j)&&!(j&this._enableFlag))return false;if(!h.msg.isAllow)return false;return true},observer:{onChatMessageReceive:function(h){if(this.checkIsNeedNotify(h)){var j,
p,u;p=h.msg;h=this._notifierManage;for(var i=this._notifier;h.length>=4;){j=h.shift();clearTimeout(j.timer);j.popup.cancel()}u=p.type=="single"?alloy.util.getUserAvatar(p.uin,1):alloy.util.getGroupAvatar(p.uin,1);j=b.decodeHtmlSimple(p.title);p=b.decodeHtmlSimple(p.content);p=p.replace(/<img.*?\/?>/ig,function(){return"\u3010\u56fe\u7247\u3011"});p=p.replace(/<br\/>/ig,"\u3000").replace(/<([^>]+).*?>/ig,"");var f=i.notify(u,j,p);if(!f){try{i.requestPermission()}catch(g){}f=i.notify(u,j,p)}if(f){var l=
setTimeout(function(){f.cancel()},this._popupHideTime);f.addEventListener("close",function(){clearTimeout(l)});h.push({popup:f,timer:l})}}}}}),q=new a.Class({init:function(){this._totalMsgCount=0;c.addObserver(alloy.portal.messageCenter,"SingleMessageReceive",a.bind(this.observer.onMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"GroupMessageReceive",a.bind(this.observer.onMessageReceive,this));c.addObserver(alloy.portal.messageCenter,"MessageHandled",a.bind(this.observer.onMessageHandled,
this));c.on(window,"beforeunload",this.observer.onWindowUnload)},checkIsNeedNotify:function(h){h=h.msg;if(h.extraInfo.isChatBoxOpen)return false;else if(!h.isAllow)return false;return true},observer:{onMessageReceive:function(h){if(this.checkIsNeedNotify(h)){this._totalMsgCount++;alloy.layout.setIe9IconOverLay(this._totalMsgCount)}},onMessageHandled:function(h){h.count=h.count||0;this._totalMsgCount-=h.count;if(this._totalMsgCount<0)this._totalMsgCount=0;alloy.layout.setIe9IconOverLay(this._totalMsgCount)},
onWindowUnload:function(){alloy.layout.setIe9IconOverLay(0)}}})});
Jx().$package("alloy.sound",function(a){var c=false,b,d=[],k=null,t=false;alloy.sound={init:function(){a.sound.onload=function(){t=true};a.sound.embedSWF(qqweb.CONST.MAIN_URL+"swf/swfsound.swf");c=false},playSound:function(m,q){if(this.isMute())return false;if(m=="")return false;q=q||false;if(typeof d[m]==="undefined"){if(!t)return false;d[m]=k=a.sound.loadSound(m,q,alloy.sound.playSoundObj)}else{k=d[m];alloy.sound.playSoundObj()}},playSoundObj:function(){a.sound.startSound(k)},setMute:function(m){c=
m},isMute:function(){return c},setVol:function(m){b=m},getVol:function(){return b}}});
Jx().$package("alloy.layout",function(a){var c=this,b=a.dom,d=a.event,k=a.fx.transitions,t=b.getDocumentElement(),m=document.body,q=b.id("startingCover"),h=document.title,j=null,p=b.id("desktop"),u,i=false,f={},g=[10,1E5,2E5,3E5,4E5],l,r,v,y,B,E,D,I,L=[],N=null;this.Panel=a.ui.Panel;this.PopupBox=a.ui.PopupBox;var J={stopPropagation:function(o){o.stopPropagation()},onClickDesktop:function(){d.notifyObservers(alloy.layout,"clickDesktop",c.getDesktop())},onFocusDesktop:function(){d.notifyObservers(alloy.layout,
"desktopFocus")},onBlurDesktop:function(){d.notifyObservers(alloy.layout,"desktopBlur")},onWindowResize:function(){a.out("desktopResize");R();d.notifyObservers(alloy.layout,"desktopResize")}},O=new a.fx.Animation({element:q,property:"opacity",from:1,to:0,unit:false,duration:500,fps:30,transition:k.quartic.easeIn});d.addObserver(O,"end",function(){b.hide(q)});var P=new a.fx.Animation({element:p,property:"opacity",from:1,to:0,unit:false,duration:500,fps:30,transition:k.quartic.easeIn});d.addObserver(P,
"end",function(){b.hide(p)});var Q=function(){a.profile("DesktopCreate");var o=b.id("mainPanel"),x=b.id("topBar"),z=b.id("toolBar"),F=b.id("qqBar");f.topArea=x;f.bottomArea=z;f.mainArea=o;f.leftArea=null;f.rightArea=null;b.setStyle(x,"height","62px");b.setStyle(x,"overflow","visible");if(a.browser.mobileSafari){o=b.id("touchpad");b.show(o);o.src=qqweb.CONST.MAIN_URL+"./touchpad.html?20101021001";d.on(m,"touchmove",function(G){G.touches&&G.touches.length==1&&G.preventDefault()},true)}o=D.createPanel({id:"desktop",
name:"desktop",container:c.getBody(),body:p,html:""});D.createPanel({id:"topBar",name:"topBar",container:x,body:x,html:""});D.createPanel({id:"qqBar",name:"qqBar",container:F,body:F,html:""});x=b.id("logo");d.on(x,"mousedown",function(){pgvSendClick({hottag:"web2qq.corner.topleft.logo"})});d.on(window,"resize",J.onWindowResize);d.on(p,"click",J.onClickDesktop);if("onfocusin"in document){d.on(document,"focusin",J.onFocusDesktop);d.on(document,"focusout",J.onBlurDesktop)}else{d.on(window,"focus",J.onFocusDesktop);
d.on(window,"blur",J.onBlurDesktop)}a.profile("DesktopCreateFinish");return o},R=function(){var o=b.getClientWidth(),x=b.getClientHeight();if(a.browser.ie==6){o=o%2+o;x=x%2+x}l=o;r=x;var z=false;if(o>=B){b.setStyle(t,"overflowX","hidden");b.setStyle(p,"width","");v=o}else{z=true;b.setStyle(t,"overflowX","auto");b.setStyle(p,"width",B+"px");v=B}if(x>=E){b.setStyle(t,"overflowY","hidden");b.setStyle(p,"height","");y=x}else{z=true;b.setStyle(t,"overflowY","auto");b.setStyle(p,"height",E+"px");y=E}z?
b.setStyle(p,"position","absolute"):b.setStyle(p,"position","static");b.setStyle(m,"height",y+"px");if(q){b.setStyle(q,"width",v+"px");b.setStyle(q,"height",y+"px")}},s=a.Class({init:function(){this.panelList=[]},createPanel:function(o){o=o||{};var x=new a.ui.Panel(o);this.panelList[o.id]=x;a.out("createPanel:"+o.name,"layout");return x},getPanel:function(o){return this.panelList[o]}});this.init=function(){if(a.browser.mobileSafari){B=680;E=640}else{B=320;E=100}D=this.panelManager=new s;Q();a.browser.firefox?
setTimeout(J.onWindowResize,100):J.onWindowResize()};this.getArea=function(o){return f[o+"Area"]};this.getAreaWidth=function(o){if(o=f[o+"Area"])return b.getWidth(o);return 0};this.getAreaHeight=function(o){if(o=f[o+"Area"])return b.getHeight(o);return 0};this.getAvailableWidth=function(){return this.getDesktopWidth()-this.getAreaWidth("left")-this.getAreaWidth("right")};this.getAvailableHeight=function(){return this.getDesktopHeight()-this.getAreaHeight("top")-this.getAreaHeight("bottom")};this.setDesktopWidth=
function(o){return v=o};this.setDesktopHeight=function(o){return y=o};this.getDesktopWidth=function(){return v};this.getDesktopHeight=function(){return y};this.getClientWidth=function(){return l=l||b.getClientWidth()};this.getClientHeight=function(){return r=r||b.getClientHeight()};this.getDesktop=function(){return D.getPanel("desktop")};this.getBody=function(){return m};this.getMaskLayer=function(){u||(u=new a.ui.MaskLayer({appendTo:this.getDesktop().body,zIndex:1,opacity:0.5}));u.reset();return u};
this.getPanel=function(o){return D.getPanel(o)};this.getTopZIndex=function(o){if(a.isUndefined(o)||!g[o])o=0;return g[o]++};this.getWindowManager=function(){if(!I){var o={defaultContainer:this.getDesktop().body};I=new alloy.businessClass.WindowManager(o);I.registerWindow("Window",alloy.businessClass.Window);I.registerWindow("Widget",alloy.businessClass.Widget)}return I};this.getThemeManager=function(){};this.showDesktop=function(){var o=[],x;x=c.getWindowManager();for(var z=x.getCurrentWindow(),F=
x.getWindowList(),G=0;G<F.length;G++){x=F[G];if(x.isShow&&x.isShow()){x.min();o.push(x)}}if(o.length>0){L=o;N=z}else{N&&N.setCurrent();for(G=0;G<L.length;G++)L[G].show()}};this.setTitle=function(o,x){x.roll=x.roll||false;x.speed=x.speed||500;if(x.roll){if(!(o.length<1)){h=document.title;j&&clearInterval(j);j=setInterval(function(){document.title=o;o=o.substr(1)+o.charAt(0)},x.speed)}}else{h=document.title;document.title=o}};this.resetTitle=function(){if(j){clearInterval(j);j=null}document.title=h};
this.setIe9IconOverLay=function(o){var x=alloy.CONST.DOMAIN,z=["overlay1","overlay2","overlay3","overlay4","overlay5","overlay6","overlay7","overlay8","overlay9","overlay10"];if(o==0)try{window.external.msSiteModeClearIconOverlay()}catch(F){}else if(o<10)try{window.external.msSiteModeSetIconOverlay("http://"+x+"/"+z[o-1]+".ico","overlay "+o);window.external.msSiteModeActivate()}catch(G){}else if(o>=10)try{window.external.msSiteModeSetIconOverlay("http://"+x+"/"+z[9]+".ico","overlay 10");window.external.msSiteModeActivate()}catch(K){}};
this.messagebox=function(o,x){x=x||{};x.innerHtml=o;return(new alloy.businessClass.MessageBox(x)).Window};this.alert=function(o,x,z){z=z||{};z.onAccept=x;z.innerHtml=o;return(new alloy.businessClass.MessageBox.Alert(z)).Window};this.confirm=function(o,x,z){z=z||{};z.onAccept=x;z.innerHtml=o;return(new alloy.businessClass.MessageBox.Confirm(z)).Window};this.hideLoginWindow=function(){var o;if(o=b.id("ifram_login"))o.src="about:blank";try{i.close()}catch(x){}};this.showLoginWindow=function(o,x){o={width:400,
height:300,title:"\u767b\u5f55WebQQ",hasCloseButton:true,isSetCurrent:true,isSetCentered:true,dragable:true,src:""};var z=window.location.protocol+"//"+window.location.host+"/loginproxy.html";if(x){z+="?login_level=3";o.title="\u767b\u5f55QQ"}else{z+="?login_level=2";o.title="\u767b\u5f55WebQQ"}z=encodeURIComponent(z);var F="";if(x){o.src="http://ui.ptlogin2.qq.com/cgi-bin/login?target=self&style=4&appid=1003903&enable_qlogin=0&no_verifyimg=1&s_url="+z+"&f_url=loginerroralert";F=a.cookie.get("closeLoginTip")==
""?'                <div id="login_window_content_area" class="content_area"><div style="display:block;position:absolute;padding-left:2px;width:100%;background:#ffffe1"><span style="float:left">\u6e29\u99a8\u63d0\u793a\uff1a\u767b\u5f55\u540e\uff0c\u60a8\u5728\u522b\u5904\u5df2\u767b\u5f55\u7684\u540c\u4e00\u5e10\u53f7\u4f1a\u4e0b\u7ebf.</span><span id="close_login_tip" onclick="this.parentNode.style.display=\'none\';" style="display:inline;cursor:pointer;float:right;margin-right:5px;">\uff58</span></div><div class="login_window_wrap">                <iframe id="ifram_login"  src="'+
o.src+'" scrolling="no" frameborder="no" allowtransparency="true" scrolling="hidden" hidefocus ></iframe>                        </div></div>':'                <div id="login_window_content_area" class="content_area"><div class="login_window_wrap">                <iframe id="ifram_login"  src="'+o.src+'" scrolling="no" frameborder="no" allowtransparency="true" scrolling="hidden" hidefocus ></iframe>                        </div></div>'}else{o.src="http://ui.ptlogin2.qq.com/cgi-bin/login?link_target=self&appid=15000101&hide_title_bar=1&no_verifyimg=1&s_url="+
z+"&f_url=loginerroralert&target=self";F='<div id="login_window_content_area" class="content_area"><div class="login_window_wrap">            <iframe id="ifram_login"  src="'+o.src+'" scrolling="no" frameborder="no" allowtransparency="true" scrolling="hidden" hidefocus ></iframe>                    </div></div>'}if(!i||!i.isShow())i=alloy.layout.messagebox("",o);else i.setCurrent();i.setHtml(F);if(x){x=b.id("loginIcon");o=b.id("loginIcon_disable");if(x&&o){b.hide(x);b.show(o)}d.addObserver(i,"close",
function(){d.notifyObservers(alloy.portal,"StrongLoginClose")})}var G=b.id("login_window_content_area");d.addObserver(i,"setNewHeight",function(){b.setStyle(G,"height","99%")});b.id("close_login_tip")&&d.on(b.id("close_login_tip"),"click",function(){this.parentNode.style.display="none";a.cookie.set("closeLoginTip","true","qq.com","",3E6)});i.show()};this.setLoginWindowHeight=function(o){i.setHeight(o)};this.hideStartingCover=function(){O.start()};this.hideDesktop=function(){P.start()}});
Jx().$package("alloy.layout.themeManager",function(a){var c=this,b=a.dom,d=a.event,k,t,m,q,h=0,j,p=function(){j||(j=document.getElementsByTagName("head")?document.getElementsByTagName("head")[0]:document.documentElement);return j},u,i={skinRoot:"",timeStamp:20110106001,window:{titleColor:"#666666",titleHeight:"39px",textColor:"#666666",titleFontWeight:"bold",bodyAreaTop:"28px",actionButtonWidth:"25px",actionButtonHeight:"25px",ie6WindowCenterBackground:"#C2D2C8",ipadContainerBackColor:"rgba(168, 218, 127, .8)"},
currentWindow:{titleColor:"black",textColor:"#333333",ipadContainerBackColor:"rgba(168, 218, 127, 1)",windowCenterBackground:"#A8DA7F",ie6WindowCenterBackground:"#A8DA7F"},appbar:{aColor:"white"},panel:{ie6Background:"#fff"}},f={blue:{id:0,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(182,234,253,.8)",ie6WindowCenterBackground:"#C4DEED"},currentWindow:{ipadContainerBackColor:"rgba(182,234,253,1)",ie6WindowCenterBackground:"#B6EAFD"}},black:{id:1,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(232,232,232,.8)",
ie6WindowCenterBackground:"#C4C4C4"},currentWindow:{ipadContainerBackColor:"rgba(232,232,232,1)",ie6WindowCenterBackground:"#e8e8e8"}},light_green:{id:2,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(168,218,127,.8)",ie6WindowCenterBackground:"#C2D2C8"},currentWindow:{ipadContainerBackColor:"rgba(168,218,127,1)",ie6WindowCenterBackground:"#A8DA7F"}},pink:{id:3,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(255,225,229,.8)",ie6WindowCenterBackground:"#CCCCCC"},currentWindow:{ipadContainerBackColor:"rgba(255,225,229,1)",
ie6WindowCenterBackground:"#FFE1E5"}},light_violet:{id:4,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(255,225,229,.8)",ie6WindowCenterBackground:"#CCCCCC"},currentWindow:{ipadContainerBackColor:"rgba(255,225,229,1)",ie6WindowCenterBackground:"#FFE1E5"}},dark_voilet:{id:5,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(255,225,229,.8)",ie6WindowCenterBackground:"#CCCCCC"},currentWindow:{ipadContainerBackColor:"rgba(255,225,229,1)",ie6WindowCenterBackground:"#FFE1E5"}},grey:{id:6,
timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(232,232,232,.8)",ie6WindowCenterBackground:"#C4C4C4"},currentWindow:{ipadContainerBackColor:"rgba(232,232,232,1)",ie6WindowCenterBackground:"#e8e8e8"}},dark_brown:{id:7,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(234,222,197,.8)",ie6WindowCenterBackground:"#C4C4C4"},currentWindow:{ipadContainerBackColor:"rgba(234,222,197,1)",ie6WindowCenterBackground:"#EADEC5"}},dark_blue:{id:8,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(232,232,232,.8)",
ie6WindowCenterBackground:"#C4C4C4"},currentWindow:{ipadContainerBackColor:"rgba(232,232,232,1)",ie6WindowCenterBackground:"#e8e8e8"}},light_blue:{id:9,timeStamp:20110106001,window:{ipadContainerBackColor:"rgba(232,232,232,.8)",ie6WindowCenterBackground:"#C4DEED"},currentWindow:{ipadContainerBackColor:"rgba(232,232,232,1)",ie6WindowCenterBackground:"#B6EAFD"}}},g={theme_blue:"blue",theme_wood2:"black",theme_green:"light_green",theme_pinky_night:"pink",theme_pinky_light:"light_violet",theme_pinky_flower:"dark_voilet",
theme_metal:"grey",theme_wood1:"dark_brown",theme_universe:"dark_blue",theme_christmas:"light_blue",theme_2011:"black",theme_spring_festival:"grey",theme_blue1:"dark_blue"},l={theme_blue:"blue.jpg",theme_wood2:"wood2.jpg",theme_green:"green.jpg",theme_pinky_night:"pinky_night.jpg",theme_pinky_light:"pinky_light.jpg",theme_pinky_flower:"pinky_flower.jpg",theme_metal:"metal.jpg",theme_wood1:"wood1.jpg",theme_universe:"universe.jpg",theme_christmas:"christmas.jpg",theme_2011:"2011.jpg",theme_spring_festival:"spring_festival.jpg",
theme_blue1:"blue1.jpg"},r={},v=function(s,o){s=b.node("style",{id:s,type:"text/css"});if(s.styleSheet)s.styleSheet.cssText=o;else{o=document.createTextNode(o);s.appendChild(o)}p().appendChild(s);return s},y=function(s,o){o=o||u;s=a.extend(i,s);return a.string.template(o,s)},B=function(s){return"http://"+(s.length||0)%10+".web.qstatic.com/webqqpic/style/wallpaper/"+l[s]},E=function(s){var o=r[s];if(!o){o="http://"+(f[s].id||0)%10+".web.qstatic.com/webqqpic/style/skin/"+s;r[s]=o}return o},D=function(){var s=
b.id("skinTemplate");u=s.innerHTML;document.body.removeChild(s);return u},I=function(){c.applyTheme("theme_blue1")},L=function(s,o){o=o||function(){};var x=s.length;if(s.length)for(var z=function(){--x<1&&o()},F=function(){z()},G=function(){z()};s.length>0;){var K=new Image;K.onload=F;K.onerror=G;K.src=s.shift()}else o()},N=new a.Class({init:function(){this._zoomWallpaperContainer=null;this._mode="repeat";var s=this;this._onWindowResize=function(){s.zoomWallpaper.apply(s)}},getMode:function(){return this._mode},
isHackLayerNeeded:function(){return true},initHackLayer:function(){if(this.isHackLayerNeeded()&&(this._mode==="repeat"||this._mode==="center")){if(!this._zoomWallpaperContainer)this._zoomWallpaperContainer=b.node("img",{id:"zoomWallpaper","class":"zoomWallpaper",style:"position:relative;z-index:-10;"});alloy.layout.getDesktop().body.appendChild(this._zoomWallpaperContainer);d.on(window,"resize",this._onWindowResize)}},removeHackLayout:function(){if(this.isHackLayerNeeded()&&(this._mode==="zoom"||
this._mode==="adapt"||this._mode==="fill")){if(this._zoomWallpaperContainer){alloy.layout.getDesktop().body.removeChild(this._zoomWallpaperContainer);this._zoomWallpaperContainer=null}d.off(window,"resize",this._onWindowResize)}else if(this._mode==="zoom"||this._mode==="adapt"||this._mode==="fill")b.removeClass(document.body,"wallpaperCss3"+this._mode)},getCurrentWallpaper:function(){return this._wallpaper},applyWallpaper:function(s,o){this._wallpaper=s;this._nMode=o;L([s],a.bind(this.onWallpaperLoaded,
this));q.closeScene()},applyBackColor:function(s){b.setStyle(document.body,"backbroundColor",s)},onWallpaperLoaded:function(){var s="url("+this._wallpaper+")";this._nMode=this._nMode||"repeat";switch(this._nMode){case "repeat":this.removeHackLayout();this._mode="repeat";b.setStyle(document.body,"backgroundImage",s);b.setStyle(document.body,"backgroundRepeat","repeat");b.setStyle(document.body,"backgroundPosition","0 0");break;case "center":this.removeHackLayout();this._mode="center";b.setStyle(document.body,
"backgroundImage",s);b.setStyle(document.body,"backgroundRepeat","no-repeat");b.setStyle(document.body,"backgroundPosition","center center");break;case "centerRepeat":this.removeHackLayout();this._mode="centerRepeat";b.setStyle(document.body,"backgroundImage",s);b.setStyle(document.body,"backgroundRepeat","repeat");b.setStyle(document.body,"backgroundPosition","center center");break;case "zoom":case "adapt":case "fill":this.initHackLayer();this._mode=this._nMode;if(this.isHackLayerNeeded()){b.setStyle(document.body,
"backgroundImage","none");this.zoomWallpaper()}else{b.setStyle(document.body,"backgroundImage",s);b.setStyle(document.body,"backgroundRepeat","no-repeat");b.addClass(document.body,"wallpaperCss3"+this._mode)}break;default:break}},zoomWallpaper:function(){var s=this,o=function(){var G=z*F.height/F.width,K=x*F.width/F.height;if(F.width/F.height>z/x)if(s._mode==="adapt"){b.setStyle(s._zoomWallpaperContainer,"height",Math.round(G)+"px");b.setStyle(s._zoomWallpaperContainer,"width",z+"px");b.setStyle(s._zoomWallpaperContainer,
"top",Math.floor((x-G)/2)+"px");a.out(Math.floor((x-G)/2)+"px")}else{b.setStyle(s._zoomWallpaperContainer,"height",x+"px");b.setStyle(s._zoomWallpaperContainer,"width",Math.ceil(K)+"px");b.setStyle(s._zoomWallpaperContainer,"left",Math.floor((z-K)/2)+"px");a.out(Math.floor((z-K)/2)+"px")}else if(s._mode==="adapt"){b.setStyle(s._zoomWallpaperContainer,"height",x+"px");b.setStyle(s._zoomWallpaperContainer,"width",Math.round(K)+"px");b.setStyle(s._zoomWallpaperContainer,"left",Math.floor((z-K)/2)+"px")}else{b.setStyle(s._zoomWallpaperContainer,
"height",Math.ceil(G)+"px");b.setStyle(s._zoomWallpaperContainer,"width",z+"px");b.setStyle(s._zoomWallpaperContainer,"top",Math.floor((x-G)/2)+"px");a.out(Math.floor((z-K)/2)+"px")}s._zoomWallpaperContainer.src=s._wallpaper},x=alloy.layout.getDesktopHeight(),z=alloy.layout.getDesktopWidth();b.setStyle(s._zoomWallpaperContainer,"top","0");b.setStyle(s._zoomWallpaperContainer,"left","0");if(this._mode==="zoom"){b.setStyle(this._zoomWallpaperContainer,"height",x+"px");b.setStyle(this._zoomWallpaperContainer,
"width",z+"px");s._zoomWallpaperContainer.src=s._wallpaper}else if(this._mode==="adapt"||this._mode==="fill"){var F=new Image;F.onload=o;F.src=this._wallpaper}},reset:function(){this.removeHackLayout();this._mode="repeat";if(a.browser.ie){document.body.style.removeAttribute("backgroundImage");document.body.style.removeAttribute("backgroundRepeat");document.body.style.removeAttribute("backgroundPosition")}else b.setStyle(document.body,"background","")}}),J=function(){return h++},O=new a.Class({init:function(){this._oldStyleNode=
b.id("skinStyleNode")},getCurrentSkin:function(){return this._skinId},applySkin:function(s){this._skinId=s;var o=f[s];this._config=o;o.skinRoot=E(s);L(this._getPreloadImages(o.skinRoot,o.timeStamp),a.bind(this._onImagePreloaded,this))},applySkinStyle:function(s){if(this._newStyleNode){this._oldStyleNode&&p().removeChild(this._oldStyleNode);this._oldStyleNode=this._newStyleNode}this._newStyleNode=v("skinStyleNode"+J(),s)},_onImagePreloaded:function(){var s=this._config.styleText;if(!s){s=y(this._config);
this._config.styleText=s}this.applySkinStyle(s)},_getPreloadImages:function(s,o){return a.browser.ie==6||a.browser.ie==7?[]:[s+"/images/task_buddy.gif?t="+o,s+"/images/toolbar_bg.png?t="+o,s+"/images/topbar_bg.png?t="+o,s+"/images/sprite_repeat_x_png.png?t="+o,s+"/images/sprite_repeat_y_png.png?t="+o,s+"/images/sprite_main_png.png?t="+o,s+"/images/appbar_bg.png?t="+o,s+"/images/appbar_bg_c.png?t="+o,s+"/images/window.png?t="+o,s+"/images/window_cur.png?t="+o,s+"/images/transparent.gif?t="+o]}}),P=
new a.Class({init:function(){this.isInit=true},applyScene:function(s){s=="theme_christmas"?alloy.portal.runApp("sceneChristmas"):this.closeScene("sceneChristmas")},closeScene:function(){alloy.app.sceneChristmas&&alloy.app.sceneChristmas.isRunning()&&alloy.app.sceneChristmas.exit()}}),Q=new a.Class({init:function(){},getCurrentTheme:function(){return this._themeId},applyTheme:function(s){this._themeId=s;var o=g[s],x=B(s);m.applyWallpaper(x);t.applySkin(o);q.applyScene(s)}});this.applyTheme=function(s){k.applyTheme(s)};
this.getCurrentThemeID=function(){return k.getCurrentTheme()};this.applyWallpaper=function(s,o){m.applyWallpaper(s,o)};this.getCurrentWallpaper=function(){return m.getCurrentWallpaper()};this.resetWallpaper=function(){m.reset()};this.applySkin=function(s){t.applySkin(s)};this.init=function(){D();k=new Q;t=new O;m=new N;q=new P;d.addObserver(alloy.portal,"UACReady",R)};var R=function(){if(alloy.portal.getUin()&&alloy.portal.getSkey()){var s=alloy.config.getTheme().id,o=alloy.config.getWallpaper().id,
x=alloy.config.getWallpaper().mode,z=alloy.config.getWallpaper().url,F=alloy.config.getAppearance().id;if(o){c.applyWallpaper(z,x);c.applySkin(F)}else c.applyTheme(s)}else I()}});
Jx().$package("alloy.rpcService",function(a){var c=this,b=a.dom,d=a.event,k,t,m=new a.Class({init:function(f){this._ajaxRequestInstant=f},send:function(f,g){g=g||{};g.cacheTime=g.cacheTime||0;g.onSuccess=g.onSuccess||function(){};g.onError=g.onError||function(){};g.onTimeout=g.onTimeout||function(){};g.onComplete=g.onComplete||function(){};var l={method:g.method||"GET",contentType:g.contentType||"",enctype:g.enctype||"",param:g.param||{},arguments:g.arguments||{},context:g.context||null,timeout:g.timeout||
3E4,onSuccess:function(v){v=v.responseText||"-";var y={};try{y=a.json.parse(v)}catch(B){a.error("alloy.rpcservice: JSON \u683c\u5f0f\u51fa\u9519","HttpRequest")}y.arguments=g.arguments||{};g.onSuccess.call(g.context,y)},onError:function(v){g.onError.call(g.context,v)},onTimeout:function(){var v={};v.arguments=g.arguments||{};g.onTimeout.call(g.context,v)},onComplete:function(){var v={};v.arguments=g.arguments||{};g.onComplete.call(g.context,v)}};alloy.portal.recoverCookie();if(l.method=="GET"){l.data=
g.data||{};var r=a.string.toQueryString(l.data);if(g.cacheTime===0)r+=r?"&t="+(new Date).getTime():"t="+(new Date).getTime();if(r)f=f+"?"+r;l.data=null}else{l.data=g.data||"";l.contentType="application/x-www-form-urlencoded";f.indexOf("?")}this._ajaxRequestInstant(f,l)}}),q=new a.Class({init:function(f,g){var l="qqweb_proxySendIframe"+f,r=this,v,y=3;this._ajaxCallbacks=[];this._proxyAjaxSend=this._proxySend=null;a.out("ProxyRequest >>>>> init: "+g,"ProxyRequest");var B=function(){if(y-- >0){a.warn("ProxyRequest >>>>> set proxyIframe src again!",
"ProxyRequest");var D=g;D+=D.indexOf("?")>-1?"&t2="+(new Date).getTime():"?t2="+(new Date).getTime();v.setAttribute("src",D)}else a.warn("ProxyRequest >>>>> set proxyIframe src over 3 time, not set now!","ProxyRequest")};f=document.body;var E=b.node("div",{"class":"hiddenIframe"});E.innerHTML='<iframe id="'+l+'" class="hiddenIframe" name="'+l+'" src="about:blank" width="1" height="1"></iframe>';f.appendChild(E);v=b.id(l);d.on(v,"load",function(){var D=window.frames[l];a.out("ProxyRequest >>>>> iframe load.",
"ProxyRequest");try{if(D.ajax){r._proxyAjaxSend=D.ajax;var I=r._ajaxCallbacks;D=0;for(var L=I.length;D<L;D++)r.proxySend(I[D].url,I[D].option);r._ajaxCallbacks=[]}else{a.warn("ProxyRequest >>>>> ajaxProxy error: ajax is undefined!!!!","ProxyRequest");B();alloy.util.report2h("proxyrequest_error","start")}}catch(N){a.error("ProxyRequest >>>>> ajaxProxy error: "+N.message+" !!!!","ProxyRequest");B();alloy.util.report2h("proxyrequest_error2","start")}});v.setAttribute("src",g)},send:function(f,g){if(this._proxyAjaxSend){this.proxySend(f,
g);this.send=this.proxySend}else this._ajaxCallbacks.push({url:f,option:g})},proxySend:function(f,g){if(!this._proxySend)this._proxySend=new m(this._proxyAjaxSend);this._proxySend.send(f,g)}}),h=new a.Class({init:function(){this._proxyArr={};this._proxyId=0},getProxyId:function(){return this._proxyId++},getProxy:function(f){var g=this._proxyArr[f];if(!g){g=new q(this.getProxyId(),f);this._proxyArr[f]=g}return g}});this.selfSend=function(f,g){k||(k=new m(a.http.ajax));k.send(f,g)};this.send=this.proxySend=
function(f,g,l){t||(t=new h);l=l||alloy.CONST.API_PROXY_URL;t.getProxy(l).send(f,g)};var j,p={_iframes:[],_tick:0,_select:function(){this._tick++;return this._iframes[(this._tick-1)%this._len]},init:function(f){if(this._isInit!=true){this._len=f;for(var g=document.body,l=0;l<f;l++){j=b.node("div",{"class":"RPCService_hDiv"});b.hide(j);j.innerHTML='<iframe id="RPCService_hIframe_'+l+'" name="RPCService_hIframe_'+l+'" src="about:blank"></iframe>';g.appendChild(j);this._iframes[l]=[j,null,"RPCService_hIframe_"+
l]}this._isInit=true}},take:function(f){var g=this._select();g[1]&&g[0].removeChild(g[1]);f.setAttribute("target",g[2]);g[1]=f;g[0].appendChild(f)}};this.formSend=function(f,g){p.init(2);g={method:g.method||"GET",enctype:g.enctype||"",data:g.data||{},onSuccess:g.onSuccess||function(){},onError:g.onError||function(){},onComplete:g.onComplete||function(){},onTimeout:g.onTimeout||function(){},timeout:g.timeout?g.timeout:1E4};f=b.node("form",{"class":"RPCService_form",method:g.method,action:f+"?t="+(new Date).getTime(),
enctype:g.enctype});if(Object.prototype.toString.call(g.data).indexOf("String")>-1){var l=b.node("input");l.type="text";l.name=g.data;f.appendChild(l)}else for(var r in g.data){l=b.node("input");l.type="text";l.name=r;l.setAttribute("value",g.data[r]);f.appendChild(l)}p.take(f);f.submit()};this.sendGetVfWebQQ=function(f,g,l){if(alloy.portal.getUin()&&alloy.portal.getSkey()){alloy.portal.speedTest.sRTS(1,"start",new Date);this.send(alloy.CONST.API_SERVER_URL+"get_vfwebqq2",{context:this,data:{},arguments:{},
onSuccess:g||function(r){if(r.retcode===0&&r.result&&r.result.length===2&&r.result[0]=="vfwebqq"){a.out(":GetVfWebQQSuccess...");d.notifyObservers(this,"GetVfWebQQSuccess",r)}else{a.out("[sendGetVfWebQQ\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+r.retcode+"-"+r.errmsg);d.notifyObservers(this,"GetVfWebQQError",r)}alloy.portal.speedTest.sRTS(1,"end",new Date,true);alloy.portal.speedTest.sRTS(4,"start",new Date);alloy.portal.speedTest.sRTS(5,"start",new Date)},onError:l||function(r){a.out("\u83b7\u53d6\u4e00\u4e2a\u4eba\u7684\u767b\u5f55\u4fe1\u606f\u5931\u8d25");
d.notifyObservers(this,"GetVfWebQQError",r);alloy.portal.speedTest.sRTS(1,"end",new Date,true)}})}else d.notifyObservers(this,"GetVfWebQQError",{})};var u,i=function(f,g){u=alloy.layout.messagebox('<div style="width:100%; height:100%; background-color:#FFFFFF; line-height:30px;">\t\t\t\t\t\t<div style="margin-left:10px;">\t\t\t\t\t\t\t<div>\u4e3a\u4e86\u60a8\u7684\u8d26\u53f7\u5b89\u5168\uff0c\u8bf7\u6267\u884c\u8eab\u4efd\u9a8c\u8bc1\uff0c\u5728\u8f93\u5165\u6846\u8f93\u5165\u4e0b\u56fe\u4e2d\u7684\u9a8c\u8bc1\u7801</div>\t\t\t\t\t\t\t<div>\u9a8c\u8bc1\u7801:&nbsp&nbsp<input id="verify_input_code" type="text" /></div>\t\t\t\t\t\t\t<img style="float:left;margin-right:10px" id="verify_img_code" src="" />\t\t\t\t\t\t\t<a style="display:inline;line-height:60px;" id="verify_a_code" alt="\u770b\u4e0d\u6e05\u6362\u4e00\u5f20" href="">\u770b\u4e0d\u6e05\u6362\u4e00\u5f20</a>\t\t\t\t\t\t\t<div id="verify_img_code_wrong" style="display:none;color:red;width:65px;">\u9a8c\u8bc1\u7801\u9519\u8bef</div>\t\t\t\t\t\t</div>\t\t\t\t\t</div>',
{title:"\u8eab\u4efd\u9a8c\u8bc1",resize:true,width:400,height:200,hasOkButton:true,isSetCentered:false});var l=b.id("verify_img_code"),r=b.id("verify_a_code"),v=b.id("verify_input_code"),y=null;d.on(l,"load",function(){y=a.cookie.get("verifysession",EQQ.CONST.MAIN_DOMAIN)});d.on(r,"click",function(B){B.preventDefault();b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+Math.random()});d.addObserver(u,"clickOkButton",function(){var B=v.value;B&&y&&g(f,B,y)});v.focus();d.on(v,
"keydown",function(B){B.keyCode==13&&d.notifyObservers(u,"clickOkButton")&&setTimeout(function(){u.close()},0)});b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+Math.random()};this.sendGetUserInfo=function(f,g,l,r){g=g||"";l=l||"";this.send(alloy.CONST.API_SERVER_URL+"get_friend_info2",{context:this,data:{tuin:f,verifysession:l,code:g,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{uin:f},onSuccess:function(v){if(v.retcode===0){setTimeout(function(){u&&u.close()},0);r?r.call(this,
v):d.notifyObservers(this,"GetUserInfoSuccess",v)}else if(v.retcode===1E3)i(f,function(y,B,E){c.sendGetUserInfo(y,B,E,r)});else if(v.retcode===1001){b.id("verify_img_code_wrong").style.display="inline";b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+Math.random();b.id("verify_input_code").value="";b.id("verify_input_code").focus()}else{setTimeout(function(){u&&u.close()},0);d.notifyObservers(this,"GetUserInfoError",v)}},onError:function(v){d.notifyObservers(this,"GetUserInfoError",
v)}})};this.sendGetSingleInfo=function(f,g,l,r){if(!g||!l)i(f,function(v,y,B){c.sendGetSingleInfo(v,y,B,r)});else{g=g||"";l=l||"";this.send(alloy.CONST.API_SERVER_URL+"get_single_info2",{context:this,data:{tuin:f,verifysession:l,code:g,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{uin:f},onSuccess:function(v){if(v.retcode===0){setTimeout(function(){u&&u.close()},0);r?r.call(this,v):d.notifyObservers(this,"GetUserInfoSuccess",v)}else if(v.retcode===1E3)i(f,function(y,B,E){c.sendGetSingleInfo(y,B,E,
r)});else if(v.retcode===1001){b.id("verify_img_code_wrong").style.display="inline";b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+Math.random();b.id("verify_input_code").value="";b.id("verify_input_code").focus()}else{setTimeout(function(){u&&u.close()},0);d.notifyObservers(this,"GetUserInfoError",v)}},onError:function(v){d.notifyObservers(this,"GetUserInfoError",v)}})}};this.sendGetUserInfo_with_code=function(f,g,l,r,v){g=g||"";l=l||"";this.send(alloy.CONST.API_SERVER_URL+
"get_stranger_info2",{context:this,data:{tuin:f,verifysession:l,gid:0,code:g,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{uin:f,code:g},onSuccess:r||function(y){if(y.retcode===0){setTimeout(function(){u&&u.close()},0);r?r.call(this,y):d.notifyObservers(this,"GetUserInfoSuccess",y)}else if(y.retcode===1E3)i(f,function(B,E,D){c.sendGetUserInfo_with_code(B,E,D)});else if(y.retcode===1001){b.id("verify_img_code_wrong").style.display="inline";b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+
Math.random();b.id("verify_input_code").value="";b.id("verify_input_code").focus()}else{setTimeout(function(){u&&u.close()},0);d.notifyObservers(this,"GetUserInfoError",y)}},onError:v||function(y){a.out("\u83b7\u53d6\u4e00\u4e2a\u4eba\u7684\u4fe1\u606f\u5931\u8d25");d.notifyObservers(this,"GetUserInfoError",y)}})};this.sendGetFriendUin2=function(f,g,l,r,v){r=r||"";v=v||"";this.send(alloy.CONST.API_SERVER_URL+"get_friend_uin2",{context:this,data:{tuin:f,verifysession:v,type:g,code:r,vfwebqq:alloy.portal.getVfWebQQ()},
arguments:{uin:f},onSuccess:function(y){if(y.retcode===0){setTimeout(function(){u&&u.close()},0);l&&l(y);d.notifyObservers(this,"GetFriendUinSuccess",y)}else if(y.retcode===1E3)i(f,function(B,E,D){c.sendGetFriendUin2(B,g,l,E,D)});else if(y.retcode===1001){b.id("verify_img_code_wrong").style.display="inline";b.id("verify_img_code").src="http://captcha.qq.com/getimage?aid=1003901&"+Math.random();b.id("verify_input_code").value="";b.id("verify_input_code").focus()}else{setTimeout(function(){u&&u.close()},
0);d.notifyObservers(this,"GetFriendUinError",y)}},onError:function(y){a.out("\u83b7\u53d6\u4e00\u4e2a\u4eba\u7684uin\u5931\u8d25");d.notifyObservers(this,"GetFriendUinError",y)}})};this.sendModifyMyDetails=function(f){f.vfwebqq=alloy.portal.getVfWebQQ();this.send(alloy.CONST.API_SERVER_URL+"modify_my_details2",{context:this,method:"POST",data:"r="+encodeURIComponent(a.json.stringify(f)),arguments:{},onSuccess:function(g){if(g.retcode===0){a.out(":ModifyMyDetailsSuccess...");d.notifyObservers(this,
"ModifyMyDetailsSuccess",g)}else{a.out("[sendModifyMyDetails\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(this,"ModifyMyDetailsError",g)}},onError:function(g){a.out("\u4fee\u6539\u81ea\u5df1\u7684\u7684\u8be6\u7ec6\u8d44\u6599\u5931\u8d25");d.notifyObservers(this,"ModifyMyDetailsError",g)}})};this.sendModifyMyAvatar=function(f){f.vfwebqq=alloy.portal.getVfWebQQ();this.send(alloy.CONST.API_SERVER_URL+"modify_my_head",{context:this,method:"POST",data:"r="+
encodeURIComponent(a.json.stringify(f)),arguments:{},onSuccess:function(g){g.retcode===0?d.notifyObservers(this,"ModifyMyAvatarSuccess",g):d.notifyObservers(this,"ModifyMyAvatarError",g)},onError:function(g){d.notifyObservers(this,"ModifyMyAvatarError",g)}})};this.sendGetGroupInfoByGid=function(f){this.send(alloy.CONST.API_SERVER_URL+"get_group_info_ext2",{context:this,data:{gcode:f,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{gcode:f},onSuccess:function(g){if(g.retcode===0){a.out(":GetUserInfoSuccess...");
d.notifyObservers(this,"GetGroupInfoByGidSuccess",g)}else{a.out("[sendGetUserInfo\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(this,"GetGroupInfoByGidError",g)}},onError:function(g){a.out("\u83b7\u53d6\u7fa4\u7684\u4fe1\u606f\u5931\u8d25");d.notifyObservers(this,"GetUserInfoError",g)}})};this.sendGetGroupPublicInfo=function(f,g,l,r){this.send(alloy.CONST.API_SERVER_URL+"get_group_public_info2",{context:this,data:{gcode:f,vfwebqq:alloy.portal.getVfWebQQ()},
arguments:g||{gcode:f},onSuccess:l||function(v){if(v.retcode===0){a.out(":GetGroupPublicInfoSuccess...");d.notifyObservers(this,"GetGroupPublicInfoSuccess",v)}else{a.out("[GetGroupPublicInfoError\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+v.retcode+"-"+v.errmsg);d.notifyObservers(this,"GetGroupPublicInfoError",v)}},onError:r||function(v){a.out("\u83b7\u53d6\u7fa4\u7684\u516c\u5171\u4fe1\u606f\u5931\u8d25");d.notifyObservers(this,"GetGroupPublicInfoError",v)}})};this.sendGetGCardInfo=function(f){this.send(alloy.CONST.API_SERVER_URL+
"get_self_business_card2",{context:this,data:{gcode:f,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{gcode:f},onSuccess:function(g){if(g.retcode===0){a.out(":GetGCardInfoSuccess...");d.notifyObservers(this,"GetGCardInfoSuccess",g)}else{a.out("[sendGetUserInfo\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(this,"GetGCardInfoError",g)}},onError:function(g){a.out("\u83b7\u53d6\u7fa4\u7684\u4fe1\u606f\u5931\u8d25");d.notifyObservers(this,"GetGCardInfoError",
g)}})};this.sendGetBuddyList=function(f,g,l){f=f||{};f.vfwebqq=alloy.portal.getVfWebQQ();alloy.portal.speedTest.sRTS(3,"start",new Date);this.send(alloy.CONST.API_SERVER_URL+"get_user_friends2",{context:this,method:"POST",data:"r="+encodeURIComponent(a.json.stringify(f)),onSuccess:g||function(r){if(r.retcode===0){for(var v=r.result.categories||[],y=false,B=0;B<v.length;B++)if(v[B].index==0)y=true;y||v.unshift({index:0,name:"\u6211\u7684\u597d\u53cb"});a.out(":GetBuddyListSuccess...1");d.notifyObservers(this,
"GetBuddyListSuccess",r.result);a.out(":GetBuddyListSuccess...2")}else{a.out("[sendGetBuddyList] error: "+r.retcode+"-"+r.errmsg);d.notifyObservers(this,"GetBuddyListError",r);a.out("[sendGetBuddyList] error: end")}},onError:l||function(r){a.out("\u597d\u53cb\u5217\u8868\u5931\u8d25");d.notifyObservers(this,"GetBuddyListError",r)}})};this.sendGetGroupList=function(f,g,l){f=f||{};f.vfwebqq=alloy.portal.getVfWebQQ();this.send(alloy.CONST.API_SERVER_URL+"get_group_name_list_mask2",{context:this,method:"POST",
data:"r="+encodeURIComponent(a.json.stringify(f)),onSuccess:g||function(r){if(r.retcode===0){d.notifyObservers(this,"GetGroupListSuccess",r.result);a.out(":GetGroupListSuccess...")}else{a.out("[sendGetGroupList] error: "+r.retcode+"-"+r.errmsg);d.notifyObservers(this,"GetGroupListError",r)}},onError:l||function(r){a.out("\u7fa4\u5217\u8868\u5931\u8d25");d.notifyObservers(this,"GetGroupListError",r)}})};this.sendGetRecentList=function(f,g,l){f=f||{};f.vfwebqq=alloy.portal.getVfWebQQ();this.send(alloy.CONST.API_SERVER_URL+
"get_recent_contact2",{context:this,method:"POST",data:"r="+encodeURIComponent(a.json.stringify(f)),onSuccess:g||function(r){if(r.retcode===0){d.notifyObservers(this,"GetRecentListSuccess",r.result);a.out(":GetRecentListSuccess...")}else{a.out("[sendGetRecentList] error: "+r.retcode+"-"+r.errmsg);d.notifyObservers(this,"GetRecentListError",r)}},onError:l||function(r){a.out("\u6700\u8fd1\u8054\u7cfb\u4eba\u5217\u8868\u5931\u8d25");d.notifyObservers(this,"GetRecentListError",r)}})};this.sendChangeGroupMask=
function(){};this.sendGetGroupInfo=function(f){f=f||{};f.vfwebqq=alloy.portal.getVfWebQQ();this.send(alloy.CONST.API_SERVER_URL+"get_group_info_ext2",{context:this,data:f,onSuccess:function(g){if(g.retcode===0){a.out(":GetGroupInfoSuccess 1...");d.notifyObservers(this,"GetGroupInfoSuccess",g.result);a.out(":GetGroupInfoSuccess 2...")}else{a.out("[sendGetGroupInfo] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(this,"GetGroupInfoError",g)}},onError:function(g){a.out("\u7fa4\u8d44\u6599\u5931\u8d25");
d.notifyObservers(this,"GetGroupInfoError",g)}})};this.sendGetQQLevel=function(f){this.send(alloy.CONST.API_SERVER_URL+"get_qq_level2",{context:this,method:"GET",data:{tuin:f,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{uin:f},onSuccess:function(g){if(g.retcode===0){a.out(":GetQQLevelSuccess 1...");d.notifyObservers(c,"GetQQLevelSuccess",g);a.out(":GetQQLevelSuccess 2...")}else{a.out("[sendGetQQLevel] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(c,"GetQQLevelError",g)}},onError:function(g){a.out("QQ\u7b49\u7ea7\u62c9\u53bb\u5931\u8d25");
d.notifyObservers(c,"GetQQLevelError",g)}})};this.sendGetSignature=function(f){this.send(alloy.CONST.API_SERVER_URL+"get_single_long_nick2",{context:this,method:"GET",data:{tuin:f,vfwebqq:alloy.portal.getVfWebQQ()},arguments:{uin:f},onSuccess:function(g){g.retcode===0?d.notifyObservers(c,"GetBuddySignatureSuccess",g):a.out("[sendGetSignature] error: "+g.retcode+"-"+g.errmsg)},onError:function(){a.out(" sendGetSignatureError")}})};this.sendGetTipsInfo=function(f){f=f||{};alloy.rpcService.selfSend(alloy.CONST.MAIN_URL+
"web2/get_msg_tip",{context:c,method:"GET",data:{uin:f.uin||"",tp:f.tp||1,id:f.id||0,retype:f.retype||1,rc:f.rc||0},onSuccess:f.onSuccess?f.onSuccess:function(g){if(g.c===0)d.notifyObservers(c,"GetTipsInfoSuccess",g);else g.c!==1&&a.error("[sendGetTipsInfo] error!")}})};this.sendQuitGroup=function(f){f.vfwebqq=alloy.portal.getVfWebQQ();alloy.rpcService.send(alloy.CONST.API_SERVER_URL+"quit_group2",{context:this,method:"POST",data:"r="+encodeURIComponent(a.json.stringify(f)),arguments:f,onSuccess:function(g){if(g.retcode===
0){a.out(":sendQuitGroup...");d.notifyObservers(alloy.rpcService,"sendQuitGroupSuccess",g)}else{a.out("[sendModifyMyDetails\uff1a\u6570\u636e\u683c\u5f0f\u9519\u8bef] error: "+g.retcode+"-"+g.errmsg);d.notifyObservers(alloy.rpcService,"sendQuitGroupError",g)}},onError:function(g){a.out("\u9000\u51fa\u5931\u8d25");d.notifyObservers(alloy.rpcService,"sendQuitGroupError",g)}})};this.sendSetConfig=function(f){f.data.vfwebqq=alloy.portal.getVfWebQQ();this.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/uac/"+
(f.action||"set")+".do",{method:"POST",data:a.string.toQueryString(f.data),onSuccess:f.onSuccess,context:f.context})};this.sendGetConfigByPost=function(f){f.data.vfwebqq=alloy.portal.getVfWebQQ();this.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/uac",{method:"POST",data:a.string.toQueryString(f.data),onSuccess:f.onSuccess,context:f.context})};this.sendSetConfigNew=function(f){this.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/newuac/"+(f.action||"set")+".do",{method:"POST",data:"r="+encodeURIComponent(a.json.stringify(f.data))+
"&vfwebqq="+alloy.portal.getVfWebQQ(),onSuccess:f.onSuccess,context:f.context})};this.sendGetConfig=function(f){f.data=f.data||{};f.data.vfwebqq=alloy.portal.getVfWebQQ();this.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/uac/"+f.action+".do",{data:f.data,onSuccess:f.onSuccess,context:f.context})};this.sendGetNewAppCount=function(){var f={};this.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/market/getnewappnumber.do",{context:this,method:"GET",data:{r:'{"appid":0,"type":[1,-1]}'},onSuccess:function(g){g.retcode===
0?d.notifyObservers(alloy.rpcService,"SendGetNewAppCountSuccess",g):d.notifyObservers(alloy.rpcService,"SendMsgError",{uin:f.to,retcode:g.retcode,errmsg:g.errmsg})},onError:function(){}})};this.sendGetDefaultAppIntroduce=function(f,g,l){f.vfwebqq=qqweb.portal.getVfWebQQ();qqweb.rpcService.selfSend(qqweb.CONST.MAIN_URL+"cgi/qqweb/market/getdefaultappinfo.do",{context:c,method:"POST",data:"appattrib="+encodeURIComponent(a.json.stringify(f)),arguments:f,onSuccess:g||function(r){r.retcode===0?onGetAppIntroduceSuccess(r.result.resultData):
a.out("\u5e94\u7528\u4ecb\u7ecd\u62c9\u53d6\u5931\u8d25"+r.errmsg)},onError:l||function(r){a.out("\u5e94\u7528\u62c9\u53d6\u5931\u8d25");d.notifyObservers(c,"GetAppIntroduceError",r)}})};this.sendReport=function(f){alloy.rpcService.formSend("http://tj.qstatic.com/log",{method:"POST",data:{r:a.string.trim(f)}})};this.reportQstatic=function(f){var g=new Image,l=alloy.portal.getCookieUin();l||(l="0");g.src="http://tj.qstatic.com/getlog?qqweb="+l+"|"+f}});
Jx().$package("alloy.appconfig",function(a){var c=this,b=a.event;c=this;var d=false,k=false,t=0,m=0,q=0;this.appConfigList={};this.appTempList={};this.systemConfigList={myPanel:{id:"myPanel",appName:"\u6211\u7684\u9762\u677f",appType:1,appLevel:"system",js:"./js/qqweb.system.module.js",windowMode:"none",customLoginValidate:true,settingCenter:0},taskBar:{id:"taskBar",appName:"\u4efb\u52a1\u680f",appType:1,appLevel:"system",windowMode:"none",customLoginValidate:true,settingCenter:0},tips:{id:"tips",
appName:"tips",appType:1,appLevel:"system",css:"./module/tips/main.css",js:"./module/tips/main.js",windowMode:"none",customLoginValidate:false,settingCenter:0},helper:{id:"helper",appName:"WebQQ\u5c0f\u52a9\u624b",appType:1,appLevel:"system",css:"./module/helper/style.css",js:"./module/helper/main.js",width:502,height:400,x:5,y:380,settingCenter:0},bubbleTip:{id:"bubbleTip",appName:"\u6c14\u6ce1\u63d0\u793a",appType:1,appLevel:"system",css:"./module/bubbletip/qqweb.app.bubbletip.css",js:"./module/bubbletip/qqweb.app.bubbletip.js",
windowMode:"none"},qqWebIme:{id:"qqWebIme",appName:"QQ\u4e91\u8f93\u5165\u6cd5",appType:1,appLevel:"system",css:"./module/qqwebime/style.css",js:"./module/qqwebime/main.js",windowMode:"none",customLoginValidate:false,settingCenter:0},qqWebDict:{id:"qqWebDict",appName:"QQ\u4e91\u8bcd\u5178",appType:1,appLevel:"system",css:"./module/qqwebdict/style.css",js:"./module/qqwebdict/main.js",windowMode:"none",customLoginValidate:false,settingCenter:0},appBar:{id:"appBar",appName:"appBar",appType:1,appLevel:"system",
windowMode:"none",settingCenter:0},appMarket:{id:"appMarket",appName:"\u5e94\u7528\u5e02\u573a",appType:2,appDesc:"\u5e94\u7528\u5e02\u573a\u662fWebQQ\u7ed9\u7f51\u53cb\u6dfb\u52a0\u5e94\u7528\u7684\u5e73\u53f0\uff0c\u63d0\u4f9b\u6700\u70ed\uff0c\u6700\u65b0\u7684\u5e94\u7528\uff0c\u7f51\u53cb\u5206\u4eab\u4e5f\u5c3d\u5728\u5176\u4e2d\u3002",appLevel:"system",appUrl:qqweb.CONST.MAIN_URL+"module/appmarket/appmarket.html",hasCloseButton:true,hasMinButton:false,hasMaxButton:true,modeSwitch:true,resize:true,
width:821,height:500,loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,settingCenter:0},themeSetting:{id:"themeSetting",appName:"\u4e3b\u9898\u8bbe\u7f6e",appType:1,appLevel:"system",css:"./module/themesetting/qqweb.app.themesetting.css",js:"./module/themesetting/qqweb.app.themesetting.js",hasMinButton:false,hasMaxButton:false,resize:false,settingCenter:0},notifySetting:{id:"notifySetting",appName:"\u6d88\u606f\u63d0\u9192",appType:1,appLevel:"system",css:"./module/notifysetting/qqweb.app.notifysetting.css",
js:"./module/notifysetting/qqweb.app.notifysetting.js",hasMinButton:false,hasMaxButton:false,hasOkButton:true,hasCancelButton:true,settingCenter:0},msgBubble:{id:"msgBubble",appType:1,appLevel:"system",appName:"\u6d88\u606f\u8d70\u9a6c\u706f",windowMode:"none",settingCenter:0},chatLogViewer:{id:"chatLogViewer",appName:"\u804a\u5929\u8bb0\u5f55\u7ba1\u7406\u5668",appType:1,appLevel:"system",css:"./module/chatlogviewer/qqweb.app.chatlogviewer.css",js:"./module/chatlogviewer/qqweb.app.chatlogviewer.js",
loginLevel:alloy.CONST.LOGIN_LEVEL_ALL,needApp:["eqq"],settingCenter:0},userDetails:{id:"userDetails",appName:"\u8be6\u7ec6\u8d44\u6599",appType:1,appLevel:"system",css:"./module/userdetails/qqweb.app.userdetails.css",js:"./module/userdetails/qqweb.app.userdetails.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,windowMode:"multi",needApp:["eqq"],settingCenter:0},avatarChanger:{id:"avatarChanger",appName:"\u4fee\u6539\u5934\u50cf",appType:1,appLevel:"system",css:"./module/avatarchanger/qqweb.app.avatarchanger.css",
js:"./module/avatarchanger/qqweb.app.avatarchanger.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,needApp:["eqq"],width:550,height:395,resize:false,hasMinButton:false,hasMaxButton:false,hasOkButton:true,hasCancelButton:true,settingCenter:0},groupDetails:{id:"groupDetails",appName:"\u7fa4\u8be6\u7ec6\u8d44\u6599",appType:1,appLevel:"system",css:"./module/groupdetails/qqweb.app.groupdetails.css",js:"./module/groupdetails/qqweb.app.groupdetails.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,windowMode:"multi",
needApp:["eqq"],settingCenter:0},groupSystemMsg:{id:"groupSystemMsg",appName:"\u7fa4\u7cfb\u7edf\u6d88\u606f",appType:1,appLevel:"system",css:"./module/groupsystemmsg/qqweb.app.groupsystemmsg.css",js:"./module/groupsystemmsg/qqweb.app.groupsystemmsg.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,windowMode:"multi",needApp:["eqq"],settingCenter:0},appIntroduce:{id:"appIntroduce",appType:1,appName:"\u5e94\u7528\u4ecb\u7ecd",appLevel:"system",appDesc:"\u5728\u8fd9\u91cc\uff0c\u5e94\u7528\u4ecb\u7ecd",
provider:"Tencent \u817e\u8baf",ver:"1.0",css:"./module/appintroduce/qqweb.app.appintroduce.css",js:"./module/appintroduce/qqweb.app.appintroduce.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,width:620,height:500,windowMode:"multi",resize:false,hasMinButton:false,hasMaxButton:false,settingCenter:0},buddyAdder:{id:"buddyAdder",appName:"\u6dfb\u52a0\u597d\u53cb",appType:1,appLevel:"system",css:"./module/buddyadder/qqweb.app.buddyadder.css",js:"./module/buddyadder/qqweb.app.buddyadder.js",loginLevel:alloy.CONST.LOGIN_LEVEL_ALL,
windowMode:"multi",needApp:["eqq"],settingCenter:0},buddyFinder:{id:"buddyFinder",appName:"\u67e5\u627e\u597d\u53cb",appType:1,appLevel:"system",css:"./module/buddyfinder/qqweb.app.buddyfinder.css",js:"./module/buddyfinder/qqweb.app.buddyfinder.js",loginLevel:alloy.CONST.LOGIN_LEVEL_ALL,width:520,height:360,modeSwitch:false,resize:false,hasMinButton:false,hasMaxButton:false,needApp:["eqq"],settingCenter:0},screenLocker:{id:"screenLocker",appName:"\u9501\u5c4f",appType:1,appLevel:"system",css:"./module/screenlocker/qqweb.app.screenlocker.css",
js:"./module/screenlocker/qqweb.app.screenlocker.js",windowMode:"none",settingCenter:0},screenCapture:{id:"screenCapture",appName:"\u622a\u5c4f",appType:1,appLevel:"system",css:"./module/screencapture/qqweb.app.screencapture.css",js:"./module/screencapture/qqweb.app.screencapture.js",windowMode:"none",settingCenter:0},settingCenter:{id:"settingCenter",appName:"\u8bbe\u7f6e\u4e2d\u5fc3",appType:1,appLevel:"system",css:"./module/settingcenter/qqweb.app.settingcenter.css",js:"./module/settingcenter/qqweb.app.settingcenter.js",
hasCloseButton:true,hasMinButton:false,hasMaxButton:false,settingCenter:0},layoutSaver:{id:"layoutSaver",appName:"\u8bb0\u5fc6\u684c\u9762\u5e03\u5c40",appType:1,appLevel:"system",css:"./module/layoutsaver/qqweb.app.layoutsaver.css",js:"./module/layoutsaver/qqweb.app.layoutsaver.js",windowMode:"none",settingCenter:0},sceneChristmas:{id:"sceneChristmas",appName:"\u5723\u8bde\u5feb\u4e50",appType:1,appLevel:"system",css:"./scene/christmas/style.css",js:"./scene/christmas/main.js",settingCenter:0},urlSave:{id:"urlSave",
appType:1,appName:"\u4e00\u952e\u53e6\u5b58\u4e3a\u5e94\u7528",appLevel:"system",appDesc:"\u5728\u8fd9\u91cc\uff0c\u4e00\u952e\u53e6\u5b58\u4e3a",ver:"1.0",css:"./module/urlsave/qqweb.app.urlsave.css",js:"./module/urlsave/qqweb.app.urlsave.js",loginLevel:alloy.CONST.LOGIN_LEVEL_NOCHAT,width:708,height:475,hasMinButton:false,hasMaxButton:false,resize:false,hasOkButton:true,hasCancelButton:true,settingCenter:0}};this.getAppConfigList=function(){return this.appConfigList};this.getAllConfig=function(i){return h(i,
this.appConfigList)||h(i,this.systemConfigList)};this.getAppConfig=function(i){return h(i,this.appConfigList)};this.getSystemConfig=function(i){return h(i,this.systemConfigList)};this.isAppConfigLoad=function(){return k};var h=function(i,f){if(i&&i.call){var g=[];for(var l in f){var r=f[l];i(r)&&g.push(r)}return g}else return f[i]};this.clearConfig=function(){this.appConfigList={}};this.addAppConfigList=function(i){var f=i.result.resultData;a.profile("AddAppConfigList");for(var g in f)if(f[g]){f[g].title=
f[g].appName;f[g].type=f[g].appType;a.extend(f[g],f[g].exinfo)}else delete f[g];a.extend(this.appConfigList,f);a.profile("AddAppConfigListEnd");b.notifyObservers(c,"AddAppConfigList",i)};this.addAppConfig=function(i){a.profile("addAppConfig");this.appConfigList[i.id]=a.extend(i,i.exinfo);j({appid:i.id,value:1,type:0});b.notifyObservers(c,"AddAppConfig",i)};this.updateAppConfig=function(i){a.profile("updateAppConfig");this.appConfigList[i.id]=i;b.notifyObservers(c,"UpdateAppConfig",i)};this.removeAppConfig=
function(i){a.profile("removeAppConfig");delete this.appConfigList[i.id];b.notifyObservers(c,"RemoveAppConfig",i)};this.setNewSystemAppCount=function(i){m=i};this.setNewAllAppCount=function(i){q=i};this.getNewSystemAppCount=function(){return m};this.getNewAllAppCount=function(){return q};var j=function(i){i.vfwebqq=alloy.portal.getVfWebQQ();alloy.rpcService.selfSend(alloy.CONST.MAIN_URL+"cgi/qqweb/market/updateapphot.do",{context:c,method:"POST",data:"appattrib="+encodeURIComponent(a.json.stringify(i)),
arguments:i,onSuccess:function(f){f.retcode!==0&&a.out("\u5e94\u7528\u6b21\u6570\u6dfb\u52a0\u5931\u8d25"+f.errmsg)},onError:function(f){a.out("\u5e94\u7528\u6b21\u6570\u6dfb\u52a0\u5931\u8d25");b.notifyObservers(c,"SetAppCountError",f)}})},p=function(i,f){i.vfwebqq=alloy.portal.getVfWebQQ();alloy.rpcService.selfSend(alloy.CONST.MAIN_URL+f,{context:c,method:"POST",arguments:i.appid,data:"appattrib="+encodeURIComponent(a.json.stringify(i)),onSuccess:function(g){if(g.retcode===0)if(d){this.addAppConfigList(g);
b.notifyObservers(c,"GetDefaultAppConfigComplete",this.getAppConfigList());a.profile("\u9ed8\u8ba4app config\u5b8c\u6210");alloy.util.report2h("def_appinfo","end")}else{b.notifyObservers(c,"GetAppConfigAsPartSuccess",g.result);t++;var l=alloy.config.getSetupAppList(),r=t*100,v=(t+1)*100;this.addAppConfigList(g);if(r<l.length){l=l.slice(r,v);p({appid:l,loadMethod:3,val:["appName","appType","appUrl","iconUrl","id","exinfo"]},"cgi/qqweb/market/getappinfo.do")}else{k=true;b.notifyObservers(c,"GetAppConfigComplete",
this.getAppConfigList());alloy.portal.speedTest.sRTS(5,"end",new Date,true);a.profile("\u81ea\u5b9a\u4e49app config\u5b8c\u6210")}}else g.retcode==1E5&&alloy.layout.alert("\u767b\u5f55\u4fe1\u606f\u8d85\u65f6,\u8bf7\u767b\u5f55\u540e\u91cd\u8bd5");qqweb.util.report2h("appinfo","end",["ok"][g.retcode]||g.retcode)},onError:function(g){a.profile("GetAppConfigError");qqweb.util.report2h(d?"def_appinfo":"appinfo","end","error");b.notifyObservers(c,"GetAppConfigError",g.resutlt)},onTimeout:function(){qqweb.util.report2h(d?
"def_appinfo":"appinfo","end","timeout")}})},u={onUACReady:function(){a.profile("UACReady\uff1a"+alloy.config.isSetupAppListLoaded());if(alloy.config.isSetupAppListLoaded())if(k)b.notifyObservers(c,"GetAppConfigComplete");else{b.notifyObservers(c,"ClearDefaultApp");var i;i=alloy.config.getSetupAppList();c.clearConfig();d=false;t=0;i=i.slice(0,100);a.profile("\u62c9\u53d6\u81ea\u5b9a\u4e49app config");alloy.util.report2h("appinfo","start");p({appid:i,loadMethod:3,val:["appName","appType","appUrl",
"iconUrl","id","exinfo"]},"cgi/qqweb/market/getappinfo.do")}else{d=true;a.profile("\u62c9\u53d6\u9ed8\u8ba4app config",a.console.TYPE.WARNING);alloy.util.report2h("def_appinfo","start");p({appid:alloy.config.getDefaultSetupAppList(),loadMethod:3,val:["appName","appType","appUrl","iconUrl","id","exinfo"]},"cgi/qqweb/market/getdefaultappinfo.do")}},onReset:function(){k=false}};b.addObserver(alloy.portal,"reset",u.onReset);b.addObserver(alloy.portal,"UACReady",u.onUACReady)});
Jx().$package(function(a){var c=a.http,b=a.event,d=1;if(top.location.host!=location.host){alloy.util.report2h("be_iframed","start");top.location=location}a.profile("Hello everyone, welcome to WebQQ, 100% loaded, we're starting... time: "+a.now());alloy.util.report2h("portal","start");alloy.portal.speedTest.sRTS(7,"start",window._SPEEDTIME_WINDOWSTART);alloy.portal.speedTest.sRTS(7,"end",new Date,true);alloy.portal.speedTest.sRTS(8,"start",new Date);d=a.browser.mobileSafari?1:0;var k="./extend/"+d+
"/extend.js?t="+alloy.CONST.UPDATE_TIME_STAMP,t="./extend/"+d+"/extend.css?t="+alloy.CONST.UPDATE_TIME_STAMP;if(t){c.loadCss(t);a.profile("loadExtendCSS:"+d)}b.onDomReady(function(){a.profile("WebQQ: dom ready!!! time: "+a.now());c.loadScript(k,{onSuccess:function(){a.profile("loadExtendJS:"+d);qqweb&&alloy.init&&alloy.init()}})})});
